{"version":3,"file":"assets/jobs-blu.18488658.js","mappings":"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","sources":["webpack://@xivanalysis/client/./node_modules/@babel/runtime-corejs3/core-js-stable/instance/flat.js","webpack://@xivanalysis/client/./src/parser/core/modules/AlwaysBeCasting.tsx","webpack://@xivanalysis/client/./src/parser/core/modules/Death.tsx","webpack://@xivanalysis/client/./src/parser/core/modules/LucidDreaming.tsx","webpack://@xivanalysis/client/./src/parser/core/modules/StatusTimeline.ts","webpack://@xivanalysis/client/./src/parser/core/modules/Weaving.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/ActionTimeline.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/AlwaysBeCasting.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/BLURaidBuffs.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/DISPLAY_ORDER.ts","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/ColdFog.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/Death.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/Defensives.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/DoTs.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/DroppedBuffs.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/GeneralCDDowntime.ts","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/Interrupts.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/MightyGuardGCDing.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/MoonFlute.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/Overheal.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/RevengeBlast.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/StatusTimeline.ts","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/Swiftcast.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/TripleTrident.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/Weaving.tsx","webpack://@xivanalysis/client/./src/parser/jobs/blu/modules/index.tsx","webpack://@xivanalysis/client/./node_modules/core-js-pure/es/array/virtual/flat.js","webpack://@xivanalysis/client/./node_modules/core-js-pure/es/instance/flat.js","webpack://@xivanalysis/client/./node_modules/core-js-pure/modules/es.array.flat.js","webpack://@xivanalysis/client/./node_modules/core-js-pure/modules/es.array.unscopables.flat.js","webpack://@xivanalysis/client/./node_modules/core-js-pure/stable/instance/flat.js"],"sourcesContent":["module.exports = require(\"core-js-pure/stable/instance/flat\");","import {Trans} from '@lingui/react'\nimport {Action} from 'data/ACTIONS'\nimport {ANIMATION_LOCK} from 'data/CONSTANTS'\nimport {Event, Events} from 'event'\nimport {Analyser} from 'parser/core/Analyser'\nimport {filter} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport CastTime from 'parser/core/modules/CastTime'\nimport Checklist, {Requirement, Rule} from 'parser/core/modules/Checklist'\nimport {Data} from 'parser/core/modules/Data'\nimport Downtime from 'parser/core/modules/Downtime'\nimport {GlobalCooldown} from 'parser/core/modules/GlobalCooldown'\nimport {SpeedAdjustments} from 'parser/core/modules/SpeedAdjustments'\nimport React from 'react'\n\nconst UPTIME_TARGET = 98\n\nexport class AlwaysBeCasting extends Analyser {\n\tstatic override handle = 'abc'\n\tstatic override debug = false\n\n\t@dependency protected castTime!: CastTime\n\t@dependency protected checklist!: Checklist\n\t@dependency protected data!: Data\n\t@dependency protected downtime!: Downtime\n\t@dependency protected globalCooldown!: GlobalCooldown\n\t@dependency protected speedAdjustments!: SpeedAdjustments\n\n\tprotected gcdUptimeSuggestionContent: JSX.Element = <Trans id=\"core.always-cast.description\">\n\t\tMake sure you're always doing something. It's often better to make small\n\t\tmistakes while keeping the GCD rolling than it is to perform the correct\n\t\trotation slowly.\n\t</Trans>\n\n\tprotected gcdUptime: number = 0\n\tprotected gcdsCounted: number = 0\n\n\tprivate lastBeginCast?: Events['prepare']\n\n\toverride initialise() {\n\t\tthis.addEventHook(\n\t\t\tfilter<Event>().source(this.parser.actor.id).type('prepare'),\n\t\t\tthis.onBeginCast\n\t\t)\n\t\tthis.addEventHook(\n\t\t\tfilter<Event>().source(this.parser.actor.id).type('action'),\n\t\t\tthis.onCast\n\t\t)\n\t\tthis.addEventHook('complete', this.onComplete)\n\t}\n\n\tprivate onBeginCast(event: Events['prepare']) {\n\t\tthis.lastBeginCast = event\n\t}\n\n\tprivate onCast(event: Events['action']) {\n\t\tconst action = this.data.getAction(event.action)\n\n\t\tif (action == null || action.onGcd == null || !action.onGcd) {\n\t\t\treturn\n\t\t}\n\n\t\tlet castTime = this.castTime.forEvent(event) ?? 0\n\t\tconst adjustedBaseGCD = this.globalCooldown.getDuration()\n\t\tif (castTime >= adjustedBaseGCD) {\n\t\t\t// Account for \"caster tax\" - animation lock on spells with cast time equal to or greater than the GCD that prevents starting the next spell until the animation finishes\n\t\t\tcastTime += ANIMATION_LOCK\n\t\t}\n\t\tconst recastTime = this.castTime.recastForEvent(event) ?? 0\n\n\t\tconst castStart = (this.lastBeginCast != null && this.lastBeginCast.action === event.action) ? this.lastBeginCast.timestamp : event.timestamp\n\t\tif (this.considerCast(action, castStart)) {\n\t\t\tconst relativeTimestamp = event.timestamp - this.parser.pull.timestamp\n\t\t\tif (castTime > relativeTimestamp) {\n\t\t\t\tthis.debug(`GCD Uptime for precast ${action.name} at ${this.parser.formatEpochTimestamp(event.timestamp, 1)} - Cast time: ${castTime} | Recast time: ${recastTime} | Time of completion: ${relativeTimestamp}`)\n\t\t\t\tthis.gcdUptime += Math.max(0, relativeTimestamp)\n\t\t\t} else {\n\t\t\t\tthis.debug(`GCD Uptime for ${action.name} at ${this.parser.formatEpochTimestamp(event.timestamp, 1)} - Cast time: ${castTime} | Recast time: ${recastTime}`)\n\t\t\t\tthis.gcdUptime += Math.max(castTime, recastTime)\n\t\t\t}\n\t\t\tthis.gcdsCounted += 1\n\t\t} else {\n\t\t\tthis.debug(`Excluding cast of ${action.name} at ${this.parser.formatEpochTimestamp(event.timestamp, 1)}`)\n\t\t}\n\t\tthis.lastBeginCast = undefined\n\t}\n\n\t/**\n\t * Implementing modules MAY override this to return false and exclude certain events from GCD uptime calculations.\n\t * By default, returns true if the cast did not start during downtime\n\t * @param action Action being considered for GCD uptime\n\t * @param timestamp Timestamp the action occurred at\n\t * @param castTime Calculated cast time of the action (adjusted by speed modifiers, if any active)\n\t */\n\tprotected considerCast(_action: Action, castStart: number) {\n\t\treturn !this.downtime.isDowntime(castStart)\n\t}\n\n\tprotected getUptimePercent(): number {\n\t\tthis.debug(`Observed ${this.gcdsCounted} GCDs for a total of ${this.gcdUptime} ms of uptime`)\n\t\tconst fightDuration = this.parser.currentDuration - this.downtime.getDowntime()\n\t\tconst uptime = this.gcdUptime / fightDuration * 100\n\t\tthis.debug(`Total fight duration: ${this.parser.currentDuration} - Downtime: ${this.downtime.getDowntime()} - Uptime percentage ${uptime}`)\n\t\treturn uptime\n\t}\n\n\tprotected onComplete() {\n\t\tif (this.gcdUptime === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.checklist.add(new Rule({\n\t\t\tname: <Trans id=\"core.always-cast.title\">Always be casting</Trans>,\n\t\t\tdescription: this.gcdUptimeSuggestionContent,\n\t\t\tdisplayOrder: -1,\n\t\t\trequirements: [\n\t\t\t\tnew Requirement({\n\t\t\t\t\tname: <Trans id=\"core.always-cast.gcd-uptime\">GCD Uptime</Trans>,\n\t\t\t\t\tpercent: this.getUptimePercent(),\n\t\t\t\t}),\n\t\t\t],\n\t\t\ttarget: UPTIME_TARGET,\n\t\t}))\n\t}\n}\n","import {Plural, Trans} from '@lingui/react'\nimport {Event, Events, FieldsBase, Resource} from 'event'\nimport React from 'react'\nimport {Actor} from 'report'\nimport {Analyser} from '../Analyser'\nimport {EventHook} from '../Dispatcher'\nimport {filter} from '../filter'\nimport {dependency} from '../Injectable'\nimport {Data} from './Data'\nimport Suggestions, {SEVERITY, Suggestion} from './Suggestions'\nimport {SimpleItem, Timeline} from './Timeline'\n\ninterface EventDeath extends FieldsBase {\n\t/** Actor that died. */\n\tactor: Actor['id'],\n\t/**\n\t * Whether or not the death should be counted.\n\t * @see `Death#shouldCountDeath`\n\t */\n\tcounted: boolean\n}\n\ninterface EventRaise extends FieldsBase {\n\t/** Actor that was raised. */\n\tactor: Actor['id']\n}\n\ndeclare module 'event' {\n\tinterface EventTypeRepository {\n\t\tdeath: EventDeath\n\t\traise: EventRaise\n\t}\n}\n\nexport interface ActorDeathInfo {\n\ttimestampDeath?: Event['timestamp']\n\ttimestampTranscendent?: Event['timestamp']\n\tcount: number\n\tduration: number\n\traiseHook?: EventHook<Events['actorUpdate']>\n}\n\nexport class Death extends Analyser {\n\tstatic override handle = 'death'\n\tstatic override debug = true\n\n\t@dependency private data!: Data\n\t@dependency private suggestions!: Suggestions\n\t@dependency private timeline!: Timeline\n\n\t/** Accumulated time the parsed actor has spent dead over the course of the fight. */\n\tget deadTime() {\n\t\treturn this.getDuration(this.parser.actor.id)\n\t}\n\n\tprivate info = new Map<Actor['id'], ActorDeathInfo>()\n\n\tgetCount(actorId: Actor['id']) {\n\t\treturn this.getActorInfo(actorId).count\n\t}\n\n\tgetDuration(actorId: Actor['id']) {\n\t\tconst actorInfo = this.getActorInfo(actorId)\n\t\tconst timestamp = this.parser.currentEpochTimestamp\n\t\tconst currentDeadTime = timestamp - (actorInfo.timestampDeath ?? timestamp)\n\t\treturn actorInfo.duration + currentDeadTime\n\t}\n\n\toverride initialise() {\n\t\t// An actor hitting 0 HP is a sign of a death.\n\t\tthis.addEventHook({\n\t\t\ttype: 'actorUpdate',\n\t\t\thp: {current: 0},\n\t\t}, this.onDeath)\n\n\t\t// An actor gaining transcendent is a sign of a raise.\n\t\tthis.addEventHook({\n\t\t\ttype: 'statusApply',\n\t\t\tstatus: this.data.statuses.TRANSCENDENT.id,\n\t\t}, this.onTranscendentApply)\n\n\t\t// Any possible death events before transcendent falls off are flakes\n\t\tthis.addEventHook({\n\t\t\ttype: 'statusRemove',\n\t\t\tstatus: this.data.statuses.TRANSCENDENT.id,\n\t\t}, this.onTranscendentRemove)\n\n\t\tthis.addEventHook('complete', this.onComplete)\n\t}\n\n\tprivate getActorInfo(actorId: Actor['id']): ActorDeathInfo {\n\t\tlet actorInfo = this.info.get(actorId)\n\t\tif (actorInfo == null) {\n\t\t\tactorInfo = {count: 0, duration: 0}\n\t\t\tthis.info.set(actorId, actorInfo)\n\t\t}\n\t\treturn actorInfo\n\t}\n\n\tprivate onDeath(event: Events['actorUpdate']) {\n\t\tconst actorInfo = this.getActorInfo(event.actor)\n\n\t\t// If we already have a death being tracked, or the player is still\n\t\t// transcendent, it's likely duplicate info, noop\n\t\tif (\n\t\t\tactorInfo.timestampDeath != null\n\t\t\t|| actorInfo.timestampTranscendent != null\n\t\t) { return }\n\n\t\tconst counted = this.shouldCountDeath(event)\n\n\t\t// Queue an event for the death\n\t\tthis.parser.queueEvent({\n\t\t\ttype: 'death',\n\t\t\ttimestamp: event.timestamp,\n\t\t\tactor: event.actor,\n\t\t\tcounted,\n\t\t})\n\n\t\t// If we're not counting, can stop here\n\t\tif (!counted) { return }\n\n\t\tactorInfo.timestampDeath = event.timestamp\n\t\tactorInfo.count++\n\n\t\t// Keep an eye out for the actor gaining health post-death - it signals that it has resurrected in some\n\t\t// manner that bypassed the transcendent check. Transcendent itself is applied before any HP gain, so\n\t\t// player actors will likely not trigger this hook.\n\t\tactorInfo.raiseHook = this.addEventHook(\n\t\t\tfilter<Event>()\n\t\t\t\t.type('actorUpdate')\n\t\t\t\t.actor(event.actor)\n\t\t\t\t.hp(filter<Resource>()\n\t\t\t\t\t.current((value): value is number => value > 0)),\n\t\t\tevent => this.onRaise(event.actor, event.timestamp),\n\t\t)\n\t}\n\n\t/**\n\t * Determine if an event presumed to represent an actor's death should\n\t * be counted as such. Override and provide custom logic for cases where\n\t * a death is forced by fights or otherwise cannot be avoided.\n\t * @param _event ActorUpdate event marking the actor's death.\n\t */\n\tprotected shouldCountDeath(_event: Events['actorUpdate']) {\n\t\treturn true\n\t}\n\n\tprivate onTranscendentApply(event: Events['statusApply']) {\n\t\tconst actorInfo = this.getActorInfo(event.target)\n\t\tactorInfo.timestampTranscendent = event.timestamp\n\t\tthis.onRaise(event.target, event.timestamp)\n\t}\n\n\tprivate onTranscendentRemove(event: Events['statusRemove']) {\n\t\tconst actorInfo = this.getActorInfo(event.target)\n\t\tactorInfo.timestampTranscendent = undefined\n\t}\n\n\tprivate onRaise(actorId: Actor['id'], timestamp: Event['timestamp']) {\n\t\tconst actorInfo = this.getActorInfo(actorId)\n\n\t\t// If there's no current death, likely duplicate info, noop\n\t\tif (actorInfo.timestampDeath == null) { return }\n\n\t\t// We only show the parsed player's deaths on the timeline itself\n\t\tif (actorId === this.parser.actor.id) {\n\t\t\tthis.addDeathToTimeline(actorInfo.timestampDeath, timestamp)\n\t\t}\n\n\t\tactorInfo.duration += timestamp - actorInfo.timestampDeath\n\t\tactorInfo.timestampDeath = undefined\n\n\t\tif (actorInfo.raiseHook != null) {\n\t\t\tthis.removeEventHook(actorInfo.raiseHook)\n\t\t\tactorInfo.raiseHook = undefined\n\t\t}\n\n\t\t// Queue the raise notification.\n\t\tthis.parser.queueEvent({\n\t\t\ttype: 'raise',\n\t\t\ttimestamp,\n\t\t\tactor: actorId,\n\t\t})\n\t}\n\n\tprotected deathSuggestionWhy(_actorId: Actor['id'], playerInfo: ActorDeathInfo): JSX.Element {\n\t\treturn <Plural\n\t\t\tid=\"core.deaths.why\"\n\t\t\tvalue={playerInfo.count}\n\t\t\t_1=\"# death\"\n\t\t\tother=\"# deaths\"\n\t\t/>\n\t}\n\n\tprivate onComplete(event: Events['complete']) {\n\t\tfor (const [actorId, actorInfo] of this.info) {\n\t\t\t// If the actor was dead on completion, and the pull was a wipe, refund the\n\t\t\t// death. It's pretty meaningless to complain about the wipe itself.\n\t\t\tif (\n\t\t\t\t(this.parser.pull.progress ?? 0) < 100\n\t\t\t\t&& actorInfo.timestampDeath != null\n\t\t\t) {\n\t\t\t\tactorInfo.count = Math.max(actorInfo.count - 1, 0)\n\t\t\t}\n\n\t\t\t// Run raise cleanup in case the actor was dead on completion\n\t\t\tthis.onRaise(actorId, event.timestamp)\n\t\t}\n\n\t\tconst playerInfo = this.getActorInfo(this.parser.actor.id)\n\t\tif (playerInfo.count === 0) { return }\n\n\t\t// Deaths are pretty morbid\n\t\tthis.suggestions.add(new Suggestion({\n\t\t\ticon: this.data.actions.RAISE.icon,\n\t\t\tcontent: <Trans id=\"core.deaths.content\">\n\t\t\t\tDon't die. Between downtime, lost gauge resources, and resurrection debuffs, dying is absolutely <em>crippling</em> to damage output.\n\t\t\t</Trans>,\n\t\t\tseverity: SEVERITY.MORBID,\n\t\t\twhy: this.deathSuggestionWhy(this.parser.actor.id, playerInfo),\n\t\t}))\n\t}\n\n\tprivate addDeathToTimeline(start: number, end: number) {\n\t\tthis.timeline.addItem(new SimpleItem({\n\t\t\tstart: start - this.parser.pull.timestamp,\n\t\t\tend: end - this.parser.pull.timestamp,\n\t\t\t// TODO: Improve?\n\t\t\tcontent: <div style={{\n\t\t\t\twidth: '100%',\n\t\t\t\theight: '100%',\n\t\t\t\tbackgroundColor: '#ce909085',\n\t\t\t}}/>,\n\t\t}))\n\t}\n}\n","import {Plural, Trans} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Event, Events} from 'event'\nimport {Analyser} from 'parser/core/Analyser'\nimport {filter} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {Data} from 'parser/core/modules/Data'\nimport Suggestions, {SEVERITY, TieredSuggestion} from 'parser/core/modules/Suggestions'\nimport React, {Fragment} from 'react'\n\n//assumptions listed after each severity\nconst SEVERITIES = {\n\tUSE_PERCENT_THRESHOLD: {\n\t\t0.8: SEVERITY.MAJOR, //less than 20% of the available time is close to not using it at all or barely\n\t\t0.4: SEVERITY.MEDIUM, //60% is not using it enough -- risks not having enough mana throughout the fight, but with cards, this may not be as applicable\n\t\t0.2: SEVERITY.MINOR, //80% of the time is used to keep it on the radar, but not punish\n\t},\n}\n\nexport class LucidDreaming extends Analyser {\n\tstatic override handle = 'lucid'\n\tstatic override dependencies = [\n\t\t'suggestions',\n\t]\n\n\t@dependency private data!: Data\n\t@dependency private suggestions!: Suggestions\n\n\tprivate lastUse = 0\n\tprivate uses = 0\n\tprivate totalHeld = 0\n\n\toverride initialise() {\n\n\t\tthis.addEventHook(filter<Event>()\n\t\t\t.source(this.parser.actor.id)\n\t\t\t.type('action')\n\t\t\t.action(this.data.actions.LUCID_DREAMING.id), this.onCastLucid)\n\t\tthis.addEventHook('complete', this.onComplete)\n\t}\n\n\tprivate onCastLucid(event: Events['action']) {\n\t\tthis.uses++\n\n\t\tif (this.lastUse === 0) { this.lastUse = this.parser.pull.timestamp }\n\n\t\tlet _held = 0\n\n\t\tif (this.uses === 1) {\n\t\t\t// The first use, take holding as from the first minute of the fight\n\t\t\t_held = event.timestamp - this.parser.pull.timestamp\n\t\t} else {\n\t\t\t// Take holding as from the time it comes off cooldown\n\t\t\t_held = event.timestamp - this.lastUse - this.data.actions.LUCID_DREAMING.cooldown\n\t\t}\n\n\t\tif (_held > 0) {\n\t\t\tthis.totalHeld += _held\n\t\t}\n\t\t//update the last use\n\t\tthis.lastUse = event.timestamp\n\t}\n\n\tprotected suggestionContent: JSX.Element = <Fragment>\n\t\t<Trans id=\"core.lucid-dreaming.suggestion.content\">\n\t\t\tTry to keep <DataLink action=\"LUCID_DREAMING\" /> on cooldown for better MP management.\n\t\t</Trans>\n\t</Fragment>\n\n\tprotected suggestionWhy(usesMissed: number, holdDuration: number): JSX.Element {\n\t\treturn <Fragment>\n\t\t\t<Trans id=\"core.lucid-dreaming.suggestion.why\">\n\t\t\t\t<Plural value={usesMissed} one=\"# use\" other=\"# uses\" /> of Lucid Dreaming <Plural value={usesMissed} one=\"was\" other=\"were\" /> missed by holding it for at least a total of {this.parser.formatDuration(holdDuration)}.\n\t\t\t</Trans>\n\t\t</Fragment>\n\t}\n\n\tprivate onComplete() {\n\t\t//uses missed reported in 1 decimal\n\t\tconst holdDuration = this.uses === 0 ? this.parser.pull.duration : this.totalHeld\n\t\tconst usesMissed = Math.floor(holdDuration / this.data.actions.LUCID_DREAMING.cooldown)\n\t\tconst notUsesPercent = usesMissed === 0 ? 0 : holdDuration/this.parser.pull.duration\n\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.LUCID_DREAMING.icon,\n\t\t\tcontent: this.suggestionContent,\n\t\t\ttiers: SEVERITIES.USE_PERCENT_THRESHOLD,\n\t\t\twhy: this.suggestionWhy(usesMissed, holdDuration),\n\t\t\tvalue: notUsesPercent,\n\t\t}))\n\t}\n}\n","import {Action} from 'data/ACTIONS'\nimport {Status} from 'data/STATUSES'\nimport {Event, Events} from 'event'\nimport _ from 'lodash'\nimport {Analyser} from '../Analyser'\nimport {filter, noneOf, oneOf} from '../filter'\nimport {dependency} from '../Injectable'\nimport {ActionTimeline} from './ActionTimeline'\nimport {Actor, Actors} from './Actors'\nimport {Data} from './Data'\nimport {SimpleRow, StatusItem} from './Timeline'\n\ninterface Usage {\n\tstart: number\n\tend?: number\n}\n\ninterface StatusTarget {\n\tusages: Usage[]\n\trow: SimpleRow\n}\n\nexport class StatusTimeline extends Analyser {\n\tstatic override handle = 'statusTimeline'\n\n\tstatic statusesStackMapping: Record<number, number> = {}\n\n\t@dependency private actionTimeline!: ActionTimeline;\n\t@dependency private actors!: Actors;\n\t@dependency private data!: Data\n\n\tprivate statusActionMap = new Map<Status['id'], Action>();\n\tprivate usages = new Map<Status['id'], Map<Actor['id'], StatusTarget>>()\n\tprivate rows = new Map<string, SimpleRow>()\n\n\toverride initialise() {\n\t\t// Hook status events\n\t\tconst playerPetIds = this.parser.pull.actors\n\t\t\t.filter(actor => actor.owner === this.parser.actor)\n\t\t\t.map(pet => pet.id)\n\n\t\tconst allPetIds = this.parser.pull.actors\n\t\t\t.filter(actor => actor.owner?.playerControlled === true)\n\t\t\t.map(pet => pet.id)\n\n\t\tconst actorFilter = filter<Event>()\n\t\t\t.source(oneOf([this.parser.actor.id, ...playerPetIds]))\n\t\t\t.target(noneOf(allPetIds))\n\n\t\tthis.addEventHook(actorFilter.type('statusApply'), this.onApply)\n\t\tthis.addEventHook(actorFilter.type('statusRemove'), this.onRemove)\n\t\tthis.addEventHook('complete', this.onComplete)\n\n\t\t// Pre-cache status->action mappings\n\t\tfor (const action of Object.values(this.data.actions)) {\n\t\t\tif (action.statusesApplied == null) { continue }\n\t\t\tfor (const status of action.statusesApplied) {\n\t\t\t\tconst statusId = this.data.statuses[status].id\n\t\t\t\tthis.statusActionMap.set(statusId, action)\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onApply(event: Events['statusApply']) {\n\t\tlet statusUsages = this.usages.get(event.status)\n\t\tif (statusUsages == null) {\n\t\t\tstatusUsages = new Map()\n\t\t\tthis.usages.set(event.status, statusUsages)\n\t\t}\n\n\t\tlet statusTarget = statusUsages.get(event.target)\n\t\tif (statusTarget == null) {\n\t\t\tconst row = this.createStatusTargetRow(event.status, event.target)\n\t\t\tif (row == null) { return }\n\t\t\tstatusTarget = {\n\t\t\t\tusages: [],\n\t\t\t\trow,\n\t\t\t}\n\t\t\tstatusUsages.set(event.target, statusTarget)\n\t\t}\n\n\t\t// If there's an existing usage on the target, this can be considered to be a refresh\n\t\tconst lastUsage = _.last(statusTarget.usages)\n\t\tif (lastUsage != null && lastUsage.end == null) {\n\t\t\treturn\n\t\t}\n\n\t\tstatusTarget.usages.push({\n\t\t\tstart: event.timestamp,\n\t\t})\n\t}\n\n\tprivate onRemove(event: Events['statusRemove']) {\n\t\tconst lastUsage = _.last(this.usages.get(event.status)?.get(event.target)?.usages)\n\t\tif (lastUsage == null) { return }\n\n\t\tlastUsage.end = event.timestamp\n\t}\n\n\tprivate onComplete() {\n\t\tfor (const [statusId, statusUsages] of this.usages) {\n\t\t\tconst status = this.data.getStatus(statusId)\n\t\t\tif (status == null) { continue }\n\n\t\t\tfor (const statusTarget of statusUsages.values()) {\n\t\t\t\tfor (const usage of statusTarget.usages) {\n\t\t\t\t\tstatusTarget.row.addItem(new StatusItem({\n\t\t\t\t\t\tstatus,\n\t\t\t\t\t\tstart: usage.start - this.parser.pull.timestamp,\n\t\t\t\t\t\tend: (usage.end ?? this.parser.pull.timestamp + this.parser.pull.duration) - this.parser.pull.timestamp,\n\t\t\t\t\t}))\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate createStatusTargetRow(statusId: Status['id'], targetId: Actor['id']) {\n\t\tconst mapping = (this.constructor as typeof StatusTimeline).statusesStackMapping\n\t\tconst remappedStatusId = mapping[statusId] ?? statusId\n\n\t\tconst rowKey = this.getRowKey(remappedStatusId, targetId)\n\n\t\tconst cachedRow = this.rows.get(rowKey)\n\t\tif (cachedRow != null) { return cachedRow }\n\n\t\tconst statusRow = this.createStatusRow(remappedStatusId)\n\t\tif (statusRow == null) { return }\n\n\t\tconst actor = this.actors.get(targetId)\n\n\t\tconst row = statusRow.addRow(new SimpleRow({\n\t\t\tlabel: actor.name,\n\t\t}))\n\n\t\tthis.rows.set(rowKey, row)\n\t\treturn row\n\t}\n\n\tprivate createStatusRow(statusId: Status['id']) {\n\t\tconst rowKey = this.getRowKey(statusId)\n\n\t\tconst cachedRow = this.rows.get(rowKey)\n\t\tif (cachedRow != null) { return cachedRow }\n\n\t\tconst action = this.statusActionMap.get(statusId)\n\t\tif (action == null) { return }\n\n\t\tconst row = this.actionTimeline.getRow(action).addRow(new SimpleRow({\n\t\t\tlabel: this.data.getStatus(statusId)?.name ?? statusId,\n\t\t\thideCollapsed: true,\n\t\t\tcollapse: true,\n\t\t}))\n\n\t\tthis.rows.set(rowKey, row)\n\t\treturn row\n\t}\n\n\tprivate getRowKey = (statusId: Status['id'], targetId?: Actor['id']) =>\n\t\t`${statusId}:${targetId}`\n}\n","import {t} from '@lingui/macro'\nimport {Trans, Plural} from '@lingui/react'\nimport NormalisedMessage from 'components/ui/NormalisedMessage'\nimport Rotation from 'components/ui/Rotation'\nimport {Action} from 'data/ACTIONS'\nimport {BASE_GCD} from 'data/CONSTANTS'\nimport {Event, Events} from 'event'\nimport {Analyser} from 'parser/core/Analyser'\nimport {filter} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport CastTime from 'parser/core/modules/CastTime'\nimport {Data} from 'parser/core/modules/Data'\nimport {Invulnerability} from 'parser/core/modules/Invulnerability'\nimport Suggestions, {TieredSuggestion, SEVERITY} from 'parser/core/modules/Suggestions'\nimport React, {ReactNode} from 'react'\nimport {Accordion} from 'semantic-ui-react'\nimport {matchClosestLower} from 'utilities'\n\nconst CAST_TIME_MAX_WEAVES = {\n\t0: 2,\n\t1000: 1,\n\t2500: 0,\n}\nconst REDUCE_MAX_WEAVES_RECAST_BELOW = 1800\nconst DEFAULT_MAX_WEAVES = 2\n\nconst WEAVING_SEVERITY = {\n\t1: SEVERITY.MEDIUM,\n\t5: SEVERITY.MAJOR,\n}\n\nexport interface Weave {\n\tleadingGcdEvent?: Events['action'],\n\ttrailingGcdEvent: Events['action'],\n\tgcdTimeDiff: number,\n\tweaves: Array<Events['action']>,\n}\n\nexport class Weaving extends Analyser {\n\tstatic override handle = 'weaving'\n\n\t@dependency protected castTime!: CastTime\n\t@dependency protected data!: Data\n\t@dependency private invulnerability!: Invulnerability\n\t@dependency protected suggestions!: Suggestions\n\n\tstatic override title = t('core.weaving.title')`Weaving Issues`\n\n\tprotected suggestionIcon: string = 'https://xivapi.com/i/001000/001785.png' // WVR Focused Synth\n\n\tprotected moduleLink = (\n\t\t<a style={{cursor: 'pointer'}} onClick={() => this.parser.scrollTo(Weaving.handle)}>\n\t\t\t<NormalisedMessage message={Weaving.title}/>\n\t\t</a>\n\t)\n\tprotected suggestionContent: ReactNode = <Trans id=\"core.weaving.content\">\n\t\tAvoid weaving more actions than you have time for in a single GCD window. Doing so will delay your next GCD, reducing possible uptime. Check the {this.moduleLink} module below for more detailed analysis.\n\t</Trans>\n\n\tprotected severity = WEAVING_SEVERITY\n\n\tprivate weaves: Array<Events['action']> = []\n\tprivate ongoingCastEvent?: Events['prepare']\n\tprivate leadingGcdEvent?: Events['action']\n\tprivate trailingGcdEvent?: Events['action']\n\tprivate badWeaves: Weave[] = []\n\n\toverride initialise() {\n\t\tconst playerFilter = filter<Event>().source(this.parser.actor.id)\n\n\t\tthis.addEventHook(playerFilter.type('prepare'), this.onBeginCast)\n\t\tthis.addEventHook(playerFilter.type('action'), this.onCast)\n\t\tthis.addEventHook(filter<Event>().type('complete'), this.onComplete)\n\t\tthis.addEventHook(filter<Event>().type('death'), this.clearWeave)\n\t}\n\n\tprivate onBeginCast(event: Events['prepare']) {\n\t\tthis.ongoingCastEvent = event\n\t}\n\n\tprivate onCast(event: Events['action']) {\n\t\tconst action = this.data.getAction(event.action)\n\n\t\t// If the action is an auto, just ignore it\n\t\tif (!action || action.autoAttack) {\n\t\t\treturn\n\t\t}\n\n\t\t// If it's not a GCD, just bump the weave count\n\t\tif (this.isOgcd(action)) {\n\t\t\tthis.weaves.push(event)\n\t\t\treturn\n\t\t}\n\n\t\tif (this.ongoingCastEvent && this.ongoingCastEvent.action === action.id) {\n\t\t\t// This event is the end of a GCD cast\n\t\t\tthis.trailingGcdEvent = {\n\t\t\t\t...event,\n\t\t\t\t// Override the timestamp of the GCD with when its cast began\n\t\t\t\ttimestamp: this.ongoingCastEvent.timestamp,\n\t\t\t}\n\t\t} else {\n\t\t\t// This event was an instant GCD (or log missed the cast starting)\n\t\t\tthis.trailingGcdEvent = event\n\t\t}\n\n\t\t// Always reset the ongoing cast\n\t\tthis.ongoingCastEvent = undefined\n\n\t\t// Throw the current state onto the history\n\t\tthis.saveIfBad()\n\n\t\t// Reset\n\t\tthis.leadingGcdEvent = this.trailingGcdEvent\n\t\tthis.weaves = []\n\t}\n\n\tprivate onComplete() {\n\t\t// If there's been at least one gcd, run a cleanup on any remnant data\n\t\tif (this.leadingGcdEvent) {\n\t\t\tthis.saveIfBad()\n\t\t}\n\n\t\t// Few triples is medium, any more is major\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.suggestionIcon,\n\t\t\tcontent: this.suggestionContent,\n\t\t\twhy: <Plural\n\t\t\t\tid=\"core.weaving.why\"\n\t\t\t\tvalue={this.badWeaves.length}\n\t\t\t\t_1=\"# instance of incorrect weaving\"\n\t\t\t\tother=\"# instances of incorrect weaving\"\n\t\t\t/>,\n\t\t\ttiers: this.severity,\n\t\t\tvalue: this.badWeaves.length,\n\t\t}))\n\t}\n\n\tprivate saveIfBad() {\n\t\tif (this.trailingGcdEvent == null) { return }\n\n\t\tconst leadingTimestamp = this.leadingGcdEvent?.timestamp ?? this.parser.pull.timestamp\n\t\tconst gcdTimeDiff = this.trailingGcdEvent.timestamp\n\t\t\t- leadingTimestamp\n\t\t\t- this.invulnerability.getDuration({\n\t\t\t\tstart: leadingTimestamp,\n\t\t\t\tend: this.trailingGcdEvent.timestamp,\n\t\t\t})\n\n\t\tconst weave: Weave = {\n\t\t\tleadingGcdEvent: this.leadingGcdEvent,\n\t\t\ttrailingGcdEvent: this.trailingGcdEvent,\n\t\t\tgcdTimeDiff,\n\t\t\tweaves: this.weaves,\n\t\t}\n\n\t\tif (weave.weaves.length === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tif (this.isBadWeave(weave)) {\n\t\t\tthis.badWeaves.push(weave)\n\t\t}\n\t}\n\n\tprivate isOgcd(action: Action) {\n\t\treturn !action.onGcd && !action.autoAttack\n\t}\n\n\tprivate isBadWeave(weave: Weave) {\n\t\t// Calc. the no. of weaves - we're ignoring any made while the boss is untargetable, and events that happened before the pull\n\t\tconst weaveCount = weave.weaves.filter(\n\t\t\tevent => true\n\t\t\t\t&& !this.invulnerability.isActive({timestamp: event.timestamp, types: ['untargetable']})\n\t\t\t\t&& event.timestamp >= this.parser.pull.timestamp,\n\t\t).length\n\n\t\tconst recast = ((weave.leadingGcdEvent != null) ? this.castTime.recastForEvent(weave.leadingGcdEvent) : undefined) ?? BASE_GCD\n\t\t// Check the downtime-adjusted GCD time difference for this weave - do not treat multiple weaves during downtime as bad weaves\n\t\treturn weave.gcdTimeDiff > recast && weaveCount > this.getMaxWeaves(weave)\n\t}\n\n\tprivate clearWeave() {\n\t\t// prompts saving any existing weaves if they're bad, and reset\n\t\tif (this.weaves.length > 0) {\n\t\t\tthis.saveIfBad()\n\t\t}\n\n\t\t// remove existing weaves and pretend the next leadingGcdEvent is like a fresh start (which I guess it is)\n\t\tthis.weaves = []\n\t\tthis.leadingGcdEvent = undefined\n\t}\n\n\t/**\n\t * Implementing classes MAY override this in order to provide custom logic for determining the number of max weaves, given the leading GCD Event\n\t * @param event The Action Event of the leading GCD.  Will be undefined for the first GCD of the pull - default behavior is to allow 2 weaves in case of missing pre-pull action\n\t * @returns number of allowed weaves after the leading GCD before flagging as bad weaving\n\t */\n\tprotected getMaxWeaves(weave: Weave): number {\n\t\tif (weave.leadingGcdEvent == null) {\n\t\t\treturn DEFAULT_MAX_WEAVES\n\t\t}\n\n\t\tconst castTime = this.castTime.forEvent(weave.leadingGcdEvent)\n\t\tif (castTime == null)  {\n\t\t\treturn DEFAULT_MAX_WEAVES\n\t\t}\n\n\t\tconst maxWeaves = matchClosestLower(CAST_TIME_MAX_WEAVES, castTime) ?? DEFAULT_MAX_WEAVES\n\t\tconst recastTime = this.castTime.recastForEvent(weave.leadingGcdEvent) ?? BASE_GCD\n\n\t\treturn maxWeaves - (recastTime < REDUCE_MAX_WEAVES_RECAST_BELOW ? 1 : 0)\n\t}\n\n\toverride output() {\n\t\tif (this.badWeaves.length === 0) {\n\t\t\treturn false\n\t\t}\n\n\t\tconst panels = this.badWeaves.map(item => ({\n\t\t\tkey: item.leadingGcdEvent?.timestamp ?? this.parser.pull.timestamp,\n\t\t\ttitle: {\n\t\t\t\tcontent: <>\n\t\t\t\t\t<strong>{this.parser.formatEpochTimestamp(item.leadingGcdEvent?.timestamp ?? this.parser.pull.timestamp)}</strong>\n\t\t\t\t\t&nbsp;-&nbsp;\n\t\t\t\t\t<Plural\n\t\t\t\t\t\tid=\"core.weaving.panel-count\"\n\t\t\t\t\t\tvalue={item.weaves.length}\n\t\t\t\t\t\t_1=\"# weave\"\n\t\t\t\t\t\tother=\"# weaves\"\n\t\t\t\t\t/>\n\t\t\t\t\t&nbsp;(\n\t\t\t\t\t{this.parser.formatDuration(item.gcdTimeDiff)}\n\t\t\t\t\t&nbsp;\n\t\t\t\t\t<Trans id=\"core.weaving.between-gcds\">between GCDs</Trans>\n\t\t\t\t\t)\n\t\t\t\t</>,\n\t\t\t},\n\t\t\tcontent: {\n\t\t\t\tcontent: <Rotation events={[\n\t\t\t\t\t...(item.leadingGcdEvent != null ? [item.leadingGcdEvent] : []),\n\t\t\t\t\t...item.weaves,\n\t\t\t\t]}/>,\n\t\t\t},\n\t\t}))\n\n\t\treturn <Accordion\n\t\t\texclusive={false}\n\t\t\tpanels={panels}\n\t\t\tstyled\n\t\t\tfluid\n\t\t/>\n\t}\n}\n","import {ActionRow, ActionTimeline as CoreActionTimeline} from 'parser/core/modules/ActionTimeline'\n\n// TODO: Would be really nice if ActionTimeline picked the name of the first\n// one used, instead of the first one in the array.\nexport class ActionTimeline extends CoreActionTimeline {\n\tstatic override rows: ActionRow[] = [\n\t\t...CoreActionTimeline.rows,\n\t\t'NIGHTBLOOM',\n\t\t'TRIPLE_TRIDENT',\n\t\t{\n\t\t\tlateResolveLabel: true,\n\t\t\tcontent: ['THE_ROSE_OF_DESTRUCTION', 'CHELONIAN_GATE'],\n\t\t},\n\t\t{\n\t\t\tlateResolveLabel: true,\n\t\t\tcontent: ['SHOCK_STRIKE', 'BLU_MOUNTAIN_BUSTER'],\n\t\t},\n\t\t'GLASS_DANCE',\n\t\t'SURPANAKHA',\n\t\t{\n\t\t\tlateResolveLabel: true,\n\t\t\tcontent: ['MATRA_MAGIC', 'DRAGON_FORCE', 'ANGELS_SNACK'],\n\t\t},\n\t\t{\n\t\t\tlateResolveLabel: true,\n\t\t\tcontent: ['FEATHER_RAIN', 'ERUPTION'],\n\t\t},\n\t\t{\n\t\t\tlateResolveLabel: true,\n\t\t\tcontent: ['PHANTOM_FLURRY', 'PHANTOM_FLURRY_KICK'],\n\t\t},\n\t\t{\n\t\t\tlateResolveLabel: true,\n\t\t\tcontent: ['QUASAR', 'J_KICK'],\n\t\t},\n\t\t{\n\t\t\tlabel: 'Raid Buffs',\n\t\t\tcontent: [\n\t\t\t\t'PECULIAR_LIGHT',\n\t\t\t\t'OFF_GUARD',\n\t\t\t],\n\t\t},\n\t\t'COLD_FOG',\n\n\t\t// Standard role actions\n\t\t'LUCID_DREAMING',\n\t\t'SWIFTCAST',\n\n\t\t// Mit\n\t\t'ADDLE',\n\t\t'MAGIC_HAMMER',\n\n\t\t// Ressurect\n\t\t'ANGEL_WHISPER',\n\n\t\t// Tanking CDs\n\t\t'DEVOUR',\n\t]\n}\n","import {Plural, Trans} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Action} from 'data/ACTIONS'\nimport {Event, Events} from 'event'\nimport {EventHook} from 'parser/core/Dispatcher'\nimport {filter, noneOf} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {History} from 'parser/core/modules/ActionWindow/History'\nimport {Actors} from 'parser/core/modules/Actors'\nimport {AlwaysBeCasting as CoreAlwaysBeCasting} from 'parser/core/modules/AlwaysBeCasting'\nimport Suggestions, {TieredSuggestion, SEVERITY} from 'parser/core/modules/Suggestions'\nimport React from 'react'\n\nconst PHANTOM_FLURRY_CHANNEL_DURATION_MAX_MS = 5000\nconst PHANTOM_FLURRY_CHANNEL_WITH_KICK_DURATION_MS = 4000\n\nconst SURPANAKHA_ANIMATION_LOCK_MS = 1000\n\n// Essentially a carbon copy of the MCH extension to ABC -- we want to treat\n// Phantom Flurry as a Flamethrower-like.\n\n// This also removes the time under Waning Nocturne (the second half of Moon Flute)\n// from the ABC report.  Can't cast, am waning.\n\ninterface PhantomFlurryWindow {\n\tstart: number\n\tend: number\n\tmanualKick: boolean\n\tinMoonFlute: boolean\n}\n\nexport class AlwaysBeCasting extends CoreAlwaysBeCasting {\n\tprivate diamondBackHistory: History<boolean> = new History<boolean>(() => (true))\n\tprivate phantomFlurryHistory: PhantomFlurryWindow[] = []\n\tprivate currentPhantomFlurry: PhantomFlurryWindow | undefined = undefined\n\tprivate phantomFlurryInterruptingActionHook?: EventHook<Events['action']>\n\tprivate surpanakhas: number = 0\n\n\toverride gcdUptimeSuggestionContent: JSX.Element = <Trans id=\"blu.always-cast.description\">\n\t\tMake sure you're always doing something. It's often better to make small\n\t\tmistakes while keeping the GCD rolling than it is to perform the correct\n\t\trotation slowly.\n\t\t<br />\n\t\tFor BLU, we count the following as GCD uptime:\n\t\t<ul>\n\t\t\t<li>Time spent under <DataLink action=\"DIAMONDBACK\" /></li>\n\t\t\t<li><DataLink status=\"WANING_NOCTURNE\" />, the forced downtime following a <DataLink action=\"MOON_FLUTE\" /></li>\n\t\t\t<li>The <DataLink action=\"PHANTOM_FLURRY\" /> channel</li>\n\t\t\t<li>The <DataLink action=\"SURPANAKHA\" /> oGCD spam</li>\n\t\t</ul>\n\t</Trans>\n\n\t@dependency private suggestions!: Suggestions\n\t@dependency private actors!: Actors\n\n\toverride initialise() {\n\t\tsuper.initialise()\n\n\t\tconst playerFilter = filter<Event>().source(this.parser.actor.id)\n\t\tconst phantomFlurryCastFilter = playerFilter\n\t\t\t.action(this.data.actions.PHANTOM_FLURRY.id)\n\t\t\t.type('action')\n\t\tconst phantomFlurryStatusFilter = playerFilter\n\t\t\t.status(this.data.statuses.PHANTOM_FLURRY.id)\n\t\t\t.type('statusRemove')\n\t\tconst phantomFlurryKick = playerFilter\n\t\t\t.action(this.data.actions.PHANTOM_FLURRY_KICK.id)\n\t\t\t.type('action')\n\n\t\tconst diamondBackFilter = playerFilter.status(this.data.statuses.DIAMONDBACK.id)\n\n\t\tconst surpanakhaCastFilter = playerFilter\n\t\t\t.action(this.data.actions.SURPANAKHA.id)\n\t\t\t.type('action')\n\n\t\tthis.addEventHook(phantomFlurryCastFilter, this.onApplyPhantomFlurry)\n\t\tthis.addEventHook(phantomFlurryStatusFilter, this.onRemovePhantomFlurry)\n\t\tthis.addEventHook(phantomFlurryKick, this.onPhantomFlurryFinalKick)\n\t\tthis.addEventHook(surpanakhaCastFilter, this.onCastSurpanakha)\n\t\tthis.addEventHook(diamondBackFilter.type('statusApply'), this.onDiamondBackApply)\n\t\tthis.addEventHook(diamondBackFilter.type('statusRemove'), this.onDiamondBackRemove)\n\t}\n\n\tprivate onDiamondBackApply(event: Events['statusApply']) {\n\t\tthis.diamondBackHistory.openNew(event.timestamp)\n\t}\n\tprivate onDiamondBackRemove(event: Events['statusRemove']) {\n\t\tthis.diamondBackHistory.closeCurrent(event.timestamp)\n\t}\n\n\tprivate onCastSurpanakha() {\n\t\tthis.surpanakhas++\n\t}\n\n\tprivate onPhantomFlurryFinalKick() {\n\t\t// We go in here when someone uses Phantom Flurry and, instead of channeling\n\t\t// the entire effect, instead presses the button a second time.\n\t\t// For DPSes this is always bad, since you want Phantom Flurry to finish\n\t\t// off your Moon Flute.  For tank/healer, pressing this button at the last\n\t\t// possible moment is a DPS gain.\n\t\t//\n\t\t// So let's just use a very simple heuristic.  We'll say that we expect\n\t\t// the full 5000ms channel, BUT, if they used the kick, then they should\n\t\t// have waited at least 4000ms for most of the channel to have happened.\n\n\t\tconst currentFlurry = this.currentPhantomFlurry ?? this.phantomFlurryHistory[this.phantomFlurryHistory.length - 1]\n\t\tif (currentFlurry === null) { return }\n\t\tcurrentFlurry.manualKick = true\n\t}\n\n\tprivate onApplyPhantomFlurry(event: Events['action']) {\n\t\tif (this.currentPhantomFlurry != null) { return }\n\n\t\tthis.currentPhantomFlurry = {\n\t\t\tstart: event.timestamp,\n\t\t\tend: event.timestamp + this.data.statuses.PHANTOM_FLURRY.duration,\n\t\t\tmanualKick: false,\n\t\t\tinMoonFlute: this.actors.current.hasStatus(this.data.statuses.WAXING_NOCTURNE.id),\n\t\t}\n\t\tconst anyActionFilter = filter<Event>()\n\t\t\t.source(this.parser.actor.id)\n\t\t\t.action(noneOf([this.data.actions.PHANTOM_FLURRY.id]))\n\t\t\t.type('action')\n\t\tthis.phantomFlurryInterruptingActionHook = this.addEventHook(anyActionFilter, this.onRemovePhantomFlurry)\n\n\t\tthis.phantomFlurryHistory.push(this.currentPhantomFlurry)\n\t}\n\n\tprivate onRemovePhantomFlurry(event: Events['statusRemove'] | Events['action']) {\n\t\tif (this.currentPhantomFlurry == null) {\n\t\t\treturn\n\t\t}\n\t\tif (this.phantomFlurryInterruptingActionHook == null) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.currentPhantomFlurry.end = event.timestamp\n\t\tthis.removeEventHook(this.phantomFlurryInterruptingActionHook)\n\n\t\tthis.currentPhantomFlurry = undefined\n\t\tthis.phantomFlurryInterruptingActionHook = undefined\n\n\t}\n\n\toverride considerCast(action: Action, castStart: number): boolean {\n\t\tif (action === this.data.actions.PHANTOM_FLURRY) {\n\t\t\tthis.debug(`Phantom Flurry began channeling at ${this.parser.formatEpochTimestamp(castStart)}`)\n\t\t\treturn false\n\t\t}\n\n\t\treturn super.considerCast(action, castStart)\n\t}\n\n\toverride getUptimePercent(): number {\n\t\tconst fightDuration = this.parser.currentDuration - this.downtime.getDowntime()\n\t\tconst flurryDuration = this.phantomFlurryHistory.reduce((acc, flurry) => {\n\t\t\tconst downtime = this.downtime.getDowntime(\n\t\t\t\tflurry.start,\n\t\t\t\tflurry.end,\n\t\t\t)\n\t\t\tconst phantomFlurryDurationOrGCD = Math.max(flurry.end - flurry.start, this.globalCooldown.getDuration())\n\t\t\treturn acc + phantomFlurryDurationOrGCD - downtime\n\t\t}, 0)\n\t\tconst surpanakhaDuration = this.surpanakhas * SURPANAKHA_ANIMATION_LOCK_MS\n\t\tconst uptime = (this.gcdUptime + flurryDuration + surpanakhaDuration) / (fightDuration) * 100\n\n\t\treturn uptime\n\t}\n\n\toverride onComplete() {\n\t\tsuper.onComplete()\n\n\t\tthis.diamondBackHistory.closeCurrent(this.parser.pull.timestamp + this.parser.pull.duration)\n\t\tconst diamondBackTimeMs = this.diamondBackHistory.entries.reduce((acc, e) => {\n\t\t\treturn acc + ((e.end ?? e.start) - e.start)\n\t\t}, 0)\n\t\tconst diamondBackSeconds = Math.ceil(diamondBackTimeMs / 1000)\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.DIAMONDBACK.icon,\n\t\t\tcontent: <Trans id=\"blu.diamondback.time.content\">\n\t\t\t\tThe ABC report will count time spent under <DataLink action=\"DIAMONDBACK\" /> as GCD uptime, but you should still aim to minimize this, since it means dropping damaging GCDs.\n\t\t\t</Trans>,\n\t\t\twhy: <Trans id=\"blu.diamondback.time.why\">\n\t\t\t\t<Plural value={diamondBackSeconds ?? 0} one=\"# second\" other=\"# seconds\" /> spent in Diamondback.\n\t\t\t</Trans>,\n\t\t\ttiers: {1: SEVERITY.MINOR},\n\t\t\tvalue: diamondBackSeconds,\n\t\t}))\n\n\t\t// Since we were already tracking Phantom Flurry, go ahead and take\n\t\t// the chance to track if they dropped any damage ticks.\n\t\tconst missingFlurryTicks = this.phantomFlurryHistory\n\t\t\t.reduce((acc, flurry) => {\n\t\t\t\tconst flurryChannelMs = flurry.end - flurry.start\n\t\t\t\tconst expectedFlurryChannel = (flurry.manualKick ? PHANTOM_FLURRY_CHANNEL_WITH_KICK_DURATION_MS : PHANTOM_FLURRY_CHANNEL_DURATION_MAX_MS)\n\t\t\t\tconst missingFlurryChannelMs = expectedFlurryChannel - flurryChannelMs\n\t\t\t\tif (missingFlurryChannelMs <= 0) { return acc }\n\n\t\t\t\tconst missingTicks = Math.ceil(missingFlurryChannelMs / 1000)\n\t\t\t\treturn acc + missingTicks\n\t\t\t}, 0)\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.PHANTOM_FLURRY.icon,\n\t\t\tcontent: <Trans id=\"blu.phantom_flurry.dropped_ticks.content\">\n\t\t\t\tDropping out of <DataLink action=\"PHANTOM_FLURRY\" /> too early will lose damage ticks.  If you are in a <DataLink action=\"MOON_FLUTE\" /> window you want to wait out the entire channel; if you are using it outside of a window and activating the final kick, wait until the last second the <DataLink status=\"PHANTOM_FLURRY\" /> effect is active.\n\t\t\t</Trans>,\n\t\t\twhy: <Trans id=\"blu.phantom_flurry.dropped_ticks.why\">\n\t\t\t\t<Plural value={missingFlurryTicks ?? 0} one=\"# Phantom Flurry tick was\" other=\"# Phantom Flurry ticks were\" /> dropped due to cancelling the channel too early.\n\t\t\t</Trans>,\n\t\t\ttiers: {\n\t\t\t\t1: SEVERITY.MINOR,  // 200/300 potency\n\t\t\t\t2: SEVERITY.MEDIUM, // 400/600 potency\n\t\t\t\t3: SEVERITY.MAJOR,  // 600/900 potency\n\t\t\t},\n\t\t\tvalue: missingFlurryTicks,\n\t\t}))\n\n\t\t// If they weren't in a Moon Flute, then they should have kicked!\n\t\tconst missingFlurryKicks = this.phantomFlurryHistory\n\t\t\t.filter(flurry => !flurry.inMoonFlute && !flurry.manualKick)\n\t\t\t.length\n\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.PHANTOM_FLURRY_KICK.icon,\n\t\t\tcontent: <Trans id=\"blu.phantom_flurry.dropped_kicks.content\">\n\t\t\t\tWhile the channel from <DataLink action=\"PHANTOM_FLURRY\" /> is active, it becomes <DataLink action=\"PHANTOM_FLURRY_KICK\" />, a 600 potency button.  If you are using <DataLink action=\"PHANTOM_FLURRY\" /> outside of a <DataLink action=\"MOON_FLUTE\" showIcon={false} /> window, then you should use the 600 potency button before the channel runs out.  Use this even if it means dropping the last tick of the channel.\n\t\t\t</Trans>,\n\t\t\twhy: <Trans id=\"blu.phantom_flurry.dropped_kicks.why\">\n\t\t\t\t<Plural value={missingFlurryKicks ?? 0} one=\"# Phantom Flurry big kick was\" other=\"# Phantom Flurry big kicks were\" /> dropped by not pressing the button again before the effect ran out.\n\t\t\t</Trans>,\n\t\t\ttiers: {\n\t\t\t\t1: SEVERITY.MEDIUM, // 390 potency\n\t\t\t\t2: SEVERITY.MAJOR, // 780 potency\n\t\t\t},\n\t\t\tvalue: missingFlurryKicks,\n\t\t}))\n\n\t}\n}\n","import {t} from '@lingui/macro'\nimport {Plural, Trans} from '@lingui/react'\nimport {ActionLink, DataLink, StatusLink} from 'components/ui/DbLink'\nimport {BlueAction} from 'data/ACTIONS/root/BLU'\nimport {Status} from 'data/STATUSES'\nimport {Event, Events, DamageType} from 'event'\nimport {Analyser} from 'parser/core/Analyser'\nimport {EventHook} from 'parser/core/Dispatcher'\nimport {filter, oneOf} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {History} from 'parser/core/modules/ActionWindow/History'\nimport {Actor, Actors} from 'parser/core/modules/Actors'\nimport {Data} from 'parser/core/modules/Data'\nimport Suggestions, {SEVERITY, TieredSuggestion} from 'parser/core/modules/Suggestions'\nimport {Timeline} from 'parser/core/modules/Timeline'\nimport React, {Fragment} from 'react'\nimport {Team} from 'report'\nimport {Message, Button, Table} from 'semantic-ui-react'\nimport {DISPLAY_ORDER} from './DISPLAY_ORDER'\n\n// BLU has *five* raid buffs.  All of them behave essentially\n// like a NIN's Mug, applying a debuff on the boss that\n// increases damage, however, four of them actually have a\n// catch to them:\n//\n//  Off-guard:            Increases all damage taken by 5%\n//  Peculiar Light:       Increases magical damage taken by 5%\n//  Physical Attenuation: Increases all physical damage taken by 5%\n//  Astral Attenuation:   Increases damage taken (but only for certain spells) by 5%\n//  Umbral Attenuation:   Increases damage taken (but only for certain spells) by 5%\n//\n// Besides Off-guard, the others have specific conditions, so their\n// effect varies wildly based on spell loadouts and bursts windows.\n//\n// In addition to that, the three Attenuation effects from\n// Condensed Libra are random, and overwrite eachother.\n//\n// While all three of the buffs stack, they all also behave like\n// Addle / Feint / Reprisal -- you can only have one instance of\n// the buff on the boss, and re-applying it overwrites the current one.\n//\n// So for Off-guard and Peculiar Light, we want to look into two things:\n//\n//      1. Check that people aren't overwriting eachother's buffs\n//      2. Check that the buffs are actually a DPS gain; for example\n//         using Peculiar Light during a Revenge Blast window is\n//         just lost damage, since Revenge Blast is physical.\n//\n// For the Libra effects, we should never check for overwrites,\n// since fishing for Physical Libra is common and a DPS gain\n// in some situations (long revenge blast windows, or before stinging)\n\ninterface BuffedEvent {\n\taction: number, // action ID\n\tunderPL: boolean,\n\tunderOG: boolean,\n\tunderLibra: boolean,\n}\n\ninterface BuffWindow {\n\tbuffAction: BlueAction,\n\tbuffId: Status['id'],\n\tisBuffedAction(arg0: BlueAction, arg1: number): boolean,\n\tevents: BuffedEvent[],\n\toverwritten: boolean,\n\tours: boolean,\n}\n\n// TODO: export these\nconst UMBRAL = 1\nconst ASTRAL = 2\n\nconst allowedBuffOverwriteMs = 2000 // Probably too high?\nconst dupedEventThresholdMs = 100\nconst fallbackBuffDuration  = 15000\n\nexport class BLURaidBuffs extends Analyser {\n\tstatic override handle = 'buffwindows'\n\tstatic override title = t('blu.buffs.title')`Buff Windows`\n\tstatic override displayOrder = DISPLAY_ORDER.RAID_BUFFS\n\n\t@dependency private actors!: Actors\n\t@dependency private data!: Data\n\t@dependency private suggestions!: Suggestions\n\t@dependency private timeline!: Timeline\n\n\tprivate inOffGuard = false\n\tprivate inPeculiarLight = false\n\tprivate inLibra = false\n\n\tprivate buffHistory: {[key: number]: History<BuffWindow>} = {}\n\tprivate buffActionHook?: EventHook<Events['action']>\n\n\tprivate PECULIAR_LIGHT_ID = this.data.statuses.PECULIAR_LIGHT.id\n\tprivate OFF_GUARD_ID      = this.data.statuses.OFF_GUARD.id\n\tprivate CONDENSED_LIBRA_ASTRAL_ID = this.data.statuses.CONDENSED_LIBRA_ASTRAL.id\n\tprivate CONDENSED_LIBRA_UMBRAL_ID = this.data.statuses.CONDENSED_LIBRA_UMBRAL.id\n\tprivate CONDENSED_LIBRA_PHYSICAL_ID = this.data.statuses.CONDENSED_LIBRA_PHYSICAL.id\n\n\tprivate newBuffHistory(st: BlueAction, fn: (arg0: BlueAction, arg1: number) => boolean) {\n\t\treturn new History<BuffWindow>(\n\t\t\t() => ({\n\t\t\t\tbuffAction: st,\n\t\t\t\tisBuffedAction: fn,\n\t\t\t\tbuffId: 0,\n\t\t\t\tevents: [],\n\t\t\t\toverwritten: false,\n\t\t\t\tours: false,\n\t\t\t})\n\t\t)\n\t}\n\n\toverride initialise() {\n\t\tsuper.initialise()\n\n\t\tthis.buffHistory[this.data.statuses.OFF_GUARD.id] = this.newBuffHistory(\n\t\t\tthis.data.actions.OFF_GUARD,\n\t\t\t() => { return true }, // buffs everything\n\t\t)\n\t\tthis.buffHistory[this.data.statuses.PECULIAR_LIGHT.id] = this.newBuffHistory(\n\t\t\tthis.data.actions.PECULIAR_LIGHT,\n\t\t\t(action) => {\n\t\t\t\treturn action.damageType === DamageType.MAGICAL\n\t\t\t},\n\t\t)\n\n\t\tconst CONDENSED_LIBRA_ASTRAL_ID = this.CONDENSED_LIBRA_ASTRAL_ID\n\t\tconst CONDENSED_LIBRA_UMBRAL_ID = this.CONDENSED_LIBRA_UMBRAL_ID\n\t\tconst CONDENSED_LIBRA_PHYSICAL_ID = this.CONDENSED_LIBRA_PHYSICAL_ID\n\t\tconst libraIsBuffed = function(action: BlueAction, buffId: Status['id']): boolean {\n\t\t\tif (buffId === CONDENSED_LIBRA_PHYSICAL_ID) {\n\t\t\t\tconst damageType = action.damageType ?? DamageType.MAGICAL\n\t\t\t\treturn damageType === DamageType.PHYSICAL\n\t\t\t}\n\n\t\t\tconst attackElement = action.elementType\n\t\t\tif (attackElement === undefined) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t\tswitch (buffId) {\n\t\t\tcase CONDENSED_LIBRA_ASTRAL_ID:\n\t\t\t\treturn attackElement === ASTRAL\n\t\t\t\tbreak\n\t\t\tcase CONDENSED_LIBRA_UMBRAL_ID:\n\t\t\t\treturn attackElement === UMBRAL\n\t\t\t\tbreak\n\t\t\t}\n\t\t\treturn false\n\t\t}\n\t\tconst libraAction = this.data.actions.CONDENSED_LIBRA\n\t\tthis.buffHistory[CONDENSED_LIBRA_ASTRAL_ID] = this.newBuffHistory(libraAction, libraIsBuffed)\n\t\tthis.buffHistory[CONDENSED_LIBRA_UMBRAL_ID] = this.newBuffHistory(libraAction, libraIsBuffed)\n\t\tthis.buffHistory[CONDENSED_LIBRA_PHYSICAL_ID] = this.newBuffHistory(libraAction, libraIsBuffed)\n\n\t\tconst statusFilter = filter<Event>()\n\t\t\t.status(oneOf(Object.keys(this.buffHistory).map(Number)))\n\t\t\t.target((target: Actor['id']): target is Actor['id'] => {\n\t\t\t\t// Match all foes, but only the parsed actor of the friends.\n\t\t\t\tconst actor = this.actors.get(target)\n\t\t\t\tif (actor.team === Team.FRIEND) {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\treturn true\n\t\t\t})\n\t\tthis.addEventHook(statusFilter.type('statusApply'), this.onApplyRaidBuff)\n\t\tthis.addEventHook(statusFilter.type('statusRemove'), this.onRemoveRaidBuff)\n\n\t\tthis.addEventHook('complete', this.onComplete)\n\t}\n\n\tprivate isDupedEvent(cur: Events['statusApply'] | Events['statusRemove'], prev?: Events['statusApply'] | Events['statusRemove']): boolean {\n\t\tif (prev === undefined) {\n\t\t\treturn false\n\t\t}\n\t\t// Duped event, seems to happen for BLU debuffs applied to the boss,\n\t\t// like the effects from Bad Breath, Magic Hammer, Off-guard, and\n\t\t// Peculiar Light.\n\t\t// There's a note deduplicateStatus.ts which seems to explain this.\n\t\t// Just do a basic dedup here:\n\t\tif (\n\t\t\tcur.status === prev.status\n\t\t\t&& cur.source === prev.source\n\t\t) {\n\t\t\tconst timestampDelta = cur.timestamp - prev.timestamp\n\t\t\tif (timestampDelta >= -dupedEventThresholdMs && timestampDelta <= dupedEventThresholdMs) {\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t\treturn false\n\t}\n\n\tprivate previousApply?: Events['statusApply']\n\tprivate onApplyRaidBuff(event: Events['statusApply']) {\n\t\tif (this.isDupedEvent(event, this.previousApply)) {\n\t\t\t// Duped event, skip it\n\t\t\treturn\n\t\t}\n\t\tthis.previousApply = event\n\n\t\tconst appliedBuffHistory = this.buffHistory[event.status]\n\t\tconst currentBuff = appliedBuffHistory.getCurrent()\n\t\tif (currentBuff !== undefined) {\n\t\t\t// This is overwriting the current Off-guard/Peculiar Light. This *might* be fine -- let's see\n\t\t\t// how much time was left on the buff\n\t\t\tconst timeLeftMs = currentBuff.start - event.timestamp\n\t\t\tif (timeLeftMs > allowedBuffOverwriteMs) {\n\t\t\t\tcurrentBuff.data.overwritten = true\n\t\t\t}\n\t\t\tappliedBuffHistory.closeCurrent(event.timestamp)\n\t\t}\n\n\t\tswitch (event.status) {\n\t\tcase (this.OFF_GUARD_ID):\n\t\t\tthis.inOffGuard = true\n\t\t\tbreak\n\t\tcase (this.PECULIAR_LIGHT_ID):\n\t\t\tthis.inPeculiarLight = true\n\t\t\tbreak\n\t\tcase (this.CONDENSED_LIBRA_ASTRAL_ID):\n\t\tcase (this.CONDENSED_LIBRA_UMBRAL_ID):\n\t\tcase (this.CONDENSED_LIBRA_PHYSICAL_ID):\n\t\t\tthis.inLibra = true\n\t\t\tbreak\n\t\t}\n\n\t\tconst newBuff = appliedBuffHistory.openNew(event.timestamp)\n\t\tnewBuff.data.buffId = event.status\n\t\tif (event.source === this.actors.current.id) {\n\t\t\tnewBuff.data.ours = true\n\t\t}\n\n\t\tif (this.buffActionHook !== undefined) {\n\t\t\t// There's already a hook installed, likely due to an overwrite.\n\t\t\t// The hooks are identical, so we can just return early\n\t\t\treturn\n\t\t}\n\n\t\t// No hook installed, so put in our own:\n\t\tconst playerTargets = this.parser.pull.actors\n\t\t\t.filter(actor => actor.team === Team.FRIEND)\n\t\t\t.map(actor => actor.id)\n\n\t\tconst playerActionFilter = filter<Event>().source(oneOf(playerTargets)).type('action')\n\t\tthis.buffActionHook = this.addEventHook(playerActionFilter, this.onActionDuringBuff)\n\t}\n\n\tprivate previousRemove?: Events['statusRemove']\n\tprivate onRemoveRaidBuff(event: Events['statusRemove']) {\n\t\tif (this.isDupedEvent(event, this.previousRemove)) {\n\t\t\t// Duped event, skip it\n\t\t\treturn\n\t\t}\n\t\tthis.previousRemove = event\n\n\t\tconst removedBuff = this.data.getStatus(event.status)\n\t\tif (removedBuff === undefined) { return }\n\n\t\tconst removedBuffHistory = this.buffHistory[event.status]\n\n\t\t// Was this an overwrite, or did it run its full course?\n\t\tconst currentBuff = removedBuffHistory.getCurrent()\n\t\tif (currentBuff !== undefined && removedBuff !== undefined) {\n\t\t\tconst buffExpectedDuration = (removedBuff.duration ?? fallbackBuffDuration) - allowedBuffOverwriteMs\n\t\t\tconst buffActualDuration = event.timestamp - currentBuff.start\n\t\t\tif (buffExpectedDuration > buffActualDuration) {\n\t\t\t\tcurrentBuff.data.overwritten = true\n\t\t\t\t// An overwrite...\n\t\t\t} else {\n\t\t\t\t// Not an overwrite, this was the buff expiring\n\t\t\t\tswitch (event.status) {\n\t\t\t\tcase this.OFF_GUARD_ID:\n\t\t\t\t\tthis.inOffGuard = false\n\t\t\t\t\tbreak\n\t\t\t\tcase this.PECULIAR_LIGHT_ID:\n\t\t\t\t\tthis.inPeculiarLight = false\n\t\t\t\t\tbreak\n\t\t\t\tcase (this.CONDENSED_LIBRA_ASTRAL_ID):\n\t\t\t\tcase (this.CONDENSED_LIBRA_UMBRAL_ID):\n\t\t\t\tcase (this.CONDENSED_LIBRA_PHYSICAL_ID):\n\t\t\t\t\tthis.inLibra = false\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tremovedBuffHistory.closeCurrent(event.timestamp)\n\t\tconst canRemoveHook = !this.inPeculiarLight && !this.inOffGuard && !this.inLibra\n\n\t\tif (this.buffActionHook != null && canRemoveHook) {\n\t\t\tthis.removeEventHook(this.buffActionHook)\n\t\t\tthis.buffActionHook = undefined\n\t\t}\n\t}\n\n\tprivate onActionDuringBuff(event: Events['action']) {\n\t\tObject.values(this.buffHistory).forEach(history => {\n\t\t\tconst buffCurrent = history.getCurrent()\n\t\t\tif (buffCurrent === undefined) { return }\n\t\t\tbuffCurrent.data.events.push({\n\t\t\t\taction: event.action,\n\t\t\t\tunderPL: this.inPeculiarLight,\n\t\t\t\tunderOG: this.inOffGuard,\n\t\t\t\tunderLibra: this.inLibra,\n\t\t\t})\n\t\t})\n\t}\n\n\tprivate onComplete() {\n\t\tObject.values(this.buffHistory).forEach(history => {\n\t\t\thistory.closeCurrent(this.parser.pull.timestamp + this.parser.pull.duration)\n\t\t})\n\n\t\t// We should not report overwrites for Condensed Libra since it's quite common to fish\n\t\t// for physical libra\n\t\tconst reportOverwrite = [\n\t\t\tthis.data.statuses.PECULIAR_LIGHT,\n\t\t\tthis.data.statuses.OFF_GUARD,\n\t\t]\n\t\treportOverwrite.forEach(buff => {\n\t\t\tconst history = this.buffHistory[buff.id]\n\t\t\tconst ourOverwritten = history.entries\n\t\t\t\t.filter(b => b.data.overwritten && b.data.ours)\n\t\t\t\t.length\n\n\t\t\t// TODO best to show seconds overwritten rather than just the count tbh\n\t\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\t\ticon: buff.icon,\n\t\t\t\tcontent: <Trans id=\"blu.buffs.overwritten.content\" >\n\t\t\t\t\tYour <StatusLink {...buff} /> was overwritten by someone else before it ran out.  This might be reasonable depending on the fight, but worth examining and figuring out if your team needs to coordinate buffs.\n\t\t\t\t</Trans>,\n\t\t\t\ttiers: {1: SEVERITY.MEDIUM},\n\t\t\t\tvalue: ourOverwritten,\n\t\t\t\twhy: <Trans id=\"blu.buffs.overwritten.why\" >\n\t\t\t\t\t<Plural value={ourOverwritten ?? 0} one=\"# application was \" other=\"# applications were\" /> overwritten by someone else\n\t\t\t\t</Trans>,\n\t\t\t}))\n\t\t})\n\t}\n\n\toverride output() {\n\t\tconst allBuffs = Object.values(this.buffHistory).map(e => e.entries).flat()\n\t\t\t.sort((a, b) => {\n\t\t\t\treturn a.start - b.start\n\t\t\t})\n\t\tif (allBuffs.length === 0) { return undefined }\n\n\t\tconst ourBuffs = allBuffs.filter(pl => pl.data.ours)\n\t\tif (ourBuffs.length === 0) { return undefined }\n\n\t\tconst rotationData = ourBuffs.map(buffWindow => {\n\t\t\tconst buffStart = buffWindow.start - this.parser.pull.timestamp\n\t\t\tconst buffEnd   = (buffWindow.end ?? buffWindow.start) - this.parser.pull.timestamp\n\n\t\t\tconst buffId         = buffWindow.data.buffId\n\t\t\tconst isBuffedAction = buffWindow.data.isBuffedAction\n\t\t\tconst relevantActionsBuffed = buffWindow.data.events.filter(e => {\n\t\t\t\tconst action     = this.data.getAction(e.action)\n\t\t\t\tif (action === undefined) { return }\n\t\t\t\tconst damageType = action?.damageType\n\t\t\t\tif (damageType === undefined) {\n\t\t\t\t\t// This filters out all the non-damaging actions, ala Bristle or Whistle\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (isBuffedAction(action, buffId)) {\n\t\t\t\t\t// This buff covers this action\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t\treturn\n\t\t\t})\n\n\t\t\tlet ogBuffed = 0\n\t\t\tlet plBuffed = 0\n\t\t\tlet libraBuffed = 0\n\t\t\trelevantActionsBuffed.forEach(e => {\n\t\t\t\tif (e.underPL) {\n\t\t\t\t\tplBuffed++\n\t\t\t\t}\n\t\t\t\tif (e.underOG) {\n\t\t\t\t\togBuffed++\n\t\t\t\t}\n\t\t\t\tif (e.underLibra) {\n\t\t\t\t\tlibraBuffed++\n\t\t\t\t}\n\t\t\t\treturn\n\t\t\t})\n\t\t\treturn {\n\t\t\t\tstart: buffStart,\n\t\t\t\tend: buffEnd,\n\t\t\t\tbuffAction: buffWindow.data.buffAction,\n\t\t\t\tbuffStatus: this.data.getStatus(buffId),\n\t\t\t\togBuffed: ogBuffed,\n\t\t\t\tplBuffed: plBuffed,\n\t\t\t\tlibraBuffed: libraBuffed,\n\t\t\t}\n\t\t}).filter(e => e !== undefined)\n\n\t\tif (rotationData.length === 0) { return }\n\n\t\treturn <Fragment>\n\t\t\t<Message>\n\t\t\t\t<Trans id=\"blu.buffs.table.message\">\n\t\t\t\tBlue Mages can keep both <ActionLink action=\"OFF_GUARD\"/> and <ActionLink action=\"PECULIAR_LIGHT\"/> up for the entire duration of the fight, and may opt to have the <ActionLink action=\"CONDENSED_LIBRA\"/> buffs running as well.\n\t\t\t\t\t<br />\n\t\t\t\tThe table below shows when you used your buffs, as well as how many damaging party actions the buff covered; it also shows how many of those actions were also covered by the other two buffs.  Ideally your team should coordinate to have <ActionLink action=\"OFF_GUARD\" showIcon={false} /> and <ActionLink action=\"PECULIAR_LIGHT\" showIcon={false} /> running all the time, making both numbers below equal.\n\t\t\t\t</Trans>\n\t\t\t</Message>\n\t\t\t<Table compact unstackable celled collapsing>\n\t\t\t\t<Table.Header>\n\t\t\t\t\t<Table.Row>\n\t\t\t\t\t\t<Table.HeaderCell><Trans id=\"blu.buffs.buff_time\">Time</Trans></Table.HeaderCell>\n\t\t\t\t\t\t<Table.HeaderCell><Trans id=\"blu.buffs.buff_yours\">Your Buff</Trans></Table.HeaderCell>\n\t\t\t\t\t\t<Table.HeaderCell><DataLink action=\"OFF_GUARD\" /></Table.HeaderCell>\n\t\t\t\t\t\t<Table.HeaderCell><DataLink action=\"PECULIAR_LIGHT\" /></Table.HeaderCell>\n\t\t\t\t\t\t<Table.HeaderCell><DataLink action=\"CONDENSED_LIBRA\" /></Table.HeaderCell>\n\t\t\t\t\t</Table.Row>\n\t\t\t\t</Table.Header>\n\t\t\t\t<Table.Body>\n\t\t\t\t\t{rotationData.map(a => {\n\t\t\t\t\t\treturn <Table.Row key={a.start}>\n\t\t\t\t\t\t\t<Table.Cell textAlign=\"center\">\n\t\t\t\t\t\t\t\t<span style={{marginRight: 5}}>{this.parser.formatEpochTimestamp(a.start + this.parser.pull.timestamp)}</span>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tcircular\n\t\t\t\t\t\t\t\t\tcompact\n\t\t\t\t\t\t\t\t\tsize=\"mini\"\n\t\t\t\t\t\t\t\t\ticon=\"time\"\n\t\t\t\t\t\t\t\t\tonClick={() => this.timeline.show(a.start, a.end)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t<Table.Cell> <StatusLink {...a.buffStatus} />\n\t\t\t\t\t\t\t</Table.Cell>\n\t\t\t\t\t\t\t<Table.Cell>{a.ogBuffed}</Table.Cell>\n\t\t\t\t\t\t\t<Table.Cell>{a.plBuffed}</Table.Cell>\n\t\t\t\t\t\t\t<Table.Cell>{a.libraBuffed}</Table.Cell>\n\t\t\t\t\t\t</Table.Row>\n\t\t\t\t\t})}\n\t\t\t\t</Table.Body>\n\t\t\t</Table>\n\t\t</Fragment>\n\t}\n}\n\n","export const DISPLAY_ORDER = {\n\tINTERRUPTED_CASTS: 1,\n\tMOON_FLUTE: 2,\n\tREVENGE_BLAST: 3,\n\tRAID_BUFFS: 4,\n\tDEFENSIVES: 5,\n\tSWIFTCAST: 6,\n\tWEAVING: 7,\n}\n","import {t} from '@lingui/macro'\nimport {Plural, Trans} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Event, Events} from 'event'\nimport {Analyser} from 'parser/core/Analyser'\nimport {EventHook} from 'parser/core/Dispatcher'\nimport {filter} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {History} from 'parser/core/modules/ActionWindow/History'\nimport {Actors} from 'parser/core/modules/Actors'\nimport {Data} from 'parser/core/modules/Data'\nimport Suggestions, {SEVERITY, TieredSuggestion} from 'parser/core/modules/Suggestions'\nimport React from 'react'\n\n// Tiered suggestion severities\nconst COLD_SEVERITY = {\n\tDROPPED_COLD_FOG: {\n\t\t1: SEVERITY.MAJOR,\n\t},\n\tDROPPED_WHITE_DEATH_CASTS: {\n\t\t1: SEVERITY.MEDIUM,\n\t},\n\tINEFFECTIVE_COLD_FOG: {\n\t\t1: SEVERITY.MAJOR,\n\t},\n}\n\nconst COLD_FOG_MINIMUM_VIABLE_CASTS = 2\nconst COLD_COLD_IDEAL_CASTS = 6\n\ninterface ColdFogWindow {\n\twhiteDeathCasts: number\n}\n\nexport class ColdFog extends Analyser {\n\tstatic override handle = 'coldfog'\n\tstatic override title = t('blu.cold_fog.title')`Cold Fog`\n\n\t@dependency private actors!: Actors\n\t@dependency private data!: Data\n\t@dependency private suggestions!: Suggestions\n\n\tprivate touchOfFrostProcs = 0\n\tprivate coldFogCasts = 0\n\tprivate touchOfFrostHistory = new History<ColdFogWindow>(\n\t\t() => ({\n\t\t\twhiteDeathCasts: 0,\n\t\t})\n\t)\n\n\toverride initialise() {\n\t\tsuper.initialise()\n\n\t\tconst playerFilter = filter<Event>().source(this.parser.actor.id)\n\t\tthis.addEventHook(playerFilter.type('statusApply').status(this.data.statuses.TOUCH_OF_FROST.id), this.onApplyTouchOfFrost)\n\t\tthis.addEventHook(playerFilter.type('statusRemove').status(this.data.statuses.TOUCH_OF_FROST.id), this.onRemoveTouchOfFrost)\n\n\t\tthis.addEventHook(playerFilter.type('statusApply').status(this.data.statuses.COLD_FOG.id), this.onApplyColdFog)\n\n\t\t// Start tracking to see if they got the six White Death GCDs during the window\n\t\tthis.addEventHook(playerFilter.action(this.data.actions.WHITE_DEATH.id).type('action'), this.onWhiteDeath)\n\n\t\tthis.addEventHook('complete', this.onComplete)\n\t}\n\n\tprivate onApplyTouchOfFrost(event: Events['statusApply']) {\n\t\tthis.touchOfFrostHistory.openNew(event.timestamp)\n\t}\n\tprivate onRemoveTouchOfFrost() {\n\t\tthis.touchOfFrostHistory.closeCurrent(this.parser.pull.timestamp + this.parser.pull.duration)\n\t}\n\n\tprivate onWhiteDeath(event: Events['action']) {\n\t\tconst current = this.touchOfFrostHistory.getCurrent()\n\t\tif (current == null) { return }\n\n\t\tif (event.action === this.data.actions.WHITE_DEATH.id) {\n\t\t\tcurrent.data.whiteDeathCasts++\n\t\t}\n\t}\n\n\tprivate onApplyColdFog() {\n\t\tthis.coldFogCasts++\n\t}\n\n\tprivate onComplete() {\n\n\t\t// Wiffled Cold Fog\n\t\tconst droppedColdFogs = this.coldFogCasts - this.touchOfFrostHistory.entries.length\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.COLD_FOG.icon,\n\t\t\tcontent: <Trans id=\"blu.coldfog.dropped.content\">\n\t\t\t\tAny damage taken while the <DataLink status=\"COLD_FOG\"/> effect is active grants the <DataLink status=\"TOUCH_OF_FROST\"/>\n\t\t\t\tbuff, allowing the use of <DataLink action=\"WHITE_DEATH\" /> for 15 seconds.\n\t\t\t\tYou should ensure you can proc every cast of <DataLink action=\"COLD_FOG\"/>.\n\t\t\t</Trans>,\n\t\t\ttiers: COLD_SEVERITY.DROPPED_COLD_FOG,\n\t\t\tvalue: droppedColdFogs,\n\t\t\twhy: <Trans id=\"blu.coldfog.dropped.why\">\n\t\t\t\t<Plural value={droppedColdFogs ?? 0} one=\"# Cold Fog use\" other=\"# Cold Fog uses\" /> did not proc <DataLink action=\"WHITE_DEATH\"  showIcon={false} showTooltip={false} />\n\t\t\t</Trans>,\n\t\t}))\n\n\t\t// Every Touch of Frost window should have at least two casts of White Death (to offset the opportunity cost of\n\t\t// casting Cold Fog), and ideally 6 or 7 casts total of White Death, depending on spell speed.\n\t\tconst ineffectiveColdFog = this.touchOfFrostHistory.entries\n\t\t\t.filter(entry => entry.data.whiteDeathCasts < COLD_FOG_MINIMUM_VIABLE_CASTS)\n\t\t\t.length\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.COLD_FOG.icon,\n\t\t\tcontent: <Trans id=\"blu.coldfog.ineffective.content\">\n\t\t\t\tFor <DataLink action=\"COLD_FOG\"/> to be effective, you need to cast <DataLink action=\"WHITE_DEATH\" />\n\t\t\t\tat least two times while under <DataLink status=\"TOUCH_OF_FROST\" />.\n\t\t\t</Trans>,\n\t\t\ttiers: COLD_SEVERITY.INEFFECTIVE_COLD_FOG,\n\t\t\tvalue: ineffectiveColdFog,\n\t\t\twhy: <Trans id=\"blu.coldfog.ineffective.why\">\n\t\t\t\t<Plural value={ineffectiveColdFog ?? 0} one=\"# Cold Fog use\" other=\"# Cold Fog uses\" /> were a DPS loss due to not using<DataLink action=\"WHITE_DEATH\"  showIcon={false} showTooltip={false} /> enough times\n\t\t\t</Trans>,\n\t\t}))\n\n\t\t// Doing less than 6 cold fogs is rarely good, although some fight timelines necessitate it.\n\t\tconst droppedWhiteDeathCasts = this.touchOfFrostHistory.entries\n\t\t\t.filter(entry => entry.data.whiteDeathCasts >= COLD_FOG_MINIMUM_VIABLE_CASTS)\n\t\t\t.filter(entry => entry.data.whiteDeathCasts  < COLD_COLD_IDEAL_CASTS)\n\t\t\t.length\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.COLD_FOG.icon,\n\t\t\tcontent: <Trans id=\"blu.coldfog.dropped_casts.content\">\n\t\t\t\t<DataLink action=\"WHITE_DEATH\" /> should be cast 6 or 7 times (depending on spell speed)\n\t\t\t\tfor each <DataLink action=\"COLD_FOG\" /> cast.\n\t\t\t</Trans>,\n\t\t\ttiers: COLD_SEVERITY.DROPPED_WHITE_DEATH_CASTS,\n\t\t\tvalue: droppedWhiteDeathCasts,\n\t\t\twhy: <Trans id=\"blu.coldfog.dropped_casts.why\">\n\t\t\t\t<Plural value={droppedWhiteDeathCasts ?? 0} one=\"# Cold Fog use\" other=\"# Cold Fog uses\" /> cast <DataLink action=\"WHITE_DEATH\"  showIcon={false} showTooltip={false} /> less than 6 times.\n\t\t\t</Trans>,\n\t\t}))\n\t}\n}\n","import {Plural, Trans} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Event, Events} from 'event'\nimport {filter, oneOf} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {Actor} from 'parser/core/modules/Actors'\nimport {Data} from 'parser/core/modules/Data'\nimport {ActorDeathInfo, Death} from 'parser/core/modules/Death'\nimport React from 'react'\n\n// Deaths from Final Sting and Self-Destruct should not count for\n// the report.\n// It would be nice to check for early stings here, but that would\n// require comparing how much damage the sting did vs how much health\n// the boss had left, which is too fight-specific.\n\nexport class BLUDeath extends Death {\n\t@dependency private mydata!: Data\n\n\tprivate isFinalSting = false\n\n\toverride initialise() {\n\t\tsuper.initialise()\n\t\tthis.addEventHook(filter<Event>().source(this.parser.actor.id).type('action')\n\t\t\t.action(oneOf([\n\t\t\t\tthis.mydata.actions.FINAL_STING.id,\n\t\t\t\tthis.mydata.actions.SELF_DESTRUCT.id,\n\t\t\t])), this.onFinalSting)\n\t}\n\n\tprivate actorStings: Map<Actor['id'], number> = new Map<Actor['id'], number>()\n\tprivate onFinalSting(event: Events['action']) {\n\t\tconst stingerId = event.source\n\t\tthis.actorStings.set(stingerId, (this.actorStings.get(stingerId) ?? 0) + 1)\n\t\tthis.isFinalSting = true\n\t}\n\n\toverride shouldCountDeath(event: Events['actorUpdate']): boolean {\n\t\tif (event.actor !== this.parser.actor.id) {\n\t\t\treturn true\n\t\t}\n\t\tif (this.isFinalSting) {\n\t\t\tthis.isFinalSting = false\n\t\t\treturn false\n\t\t}\n\t\treturn true\n\t}\n\n\toverride deathSuggestionWhy(actorId: Actor['id'], playerInfo: ActorDeathInfo): JSX.Element {\n\t\tconst actorStings = this.actorStings.get(actorId) ?? 0\n\t\tif (actorStings === 0) {\n\t\t\tsuper.deathSuggestionWhy(actorId, playerInfo)\n\t\t}\n\n\t\treturn <Trans id=\"blu.deaths.why\">\n\t\t\t<Plural id=\"blu.deaths.why.death_count\"\n\t\t\t\tvalue={playerInfo.count}\n\t\t\t\t_1=\"# death\"\n\t\t\t\tother=\"# deaths\"\n\t\t\t/>.  That number does not include the <Plural id=\"blu.deaths.why.final_stings\"\n\t\t\t\tvalue={actorStings}\n\t\t\t\t_1=\"# death\"\n\t\t\t\tother=\"# deaths\"\n\t\t\t/> from using <DataLink action=\"FINAL_STING\"/>\n\t\t</Trans>\n\t}\n}\n\n","import {Trans} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Status} from 'data/STATUSES'\nimport {Event, Events} from 'event'\nimport {filter, oneOf} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {Defensives as CoreDefensives} from 'parser/core/modules/Defensives'\nimport Suggestions, {SEVERITY, Suggestion} from 'parser/core/modules/Suggestions'\nimport React from 'react'\nimport {DISPLAY_ORDER} from './DISPLAY_ORDER'\n\n// Defensive suggestions are a bit different for each mimickry.\n// And since we are already checking for mimickry, add a suggestion\n// if they don't have one running!\n\nexport class Defensives extends CoreDefensives {\n\tstatic override displayOrder = DISPLAY_ORDER.DEFENSIVES\n\n\t// Basic defensives.  Not everyone is going to have the spell slots for Magic Hammer,\n\t// so this might be a bit of noise, sadly.\n\tprotected override trackedDefensives = [\n\t\tthis.data.actions.ADDLE,\n\t\tthis.data.actions.MAGIC_HAMMER,\n\t]\n\n\t@dependency private suggestions!: Suggestions\n\n\tprivate currentMimicry?: Status['id']\n\toverride initialise() {\n\t\tsuper.initialise()\n\n\t\t// This is missing a million edge cases, like people taking off\n\t\t// mimicry mid-pull or turning it on mid-pull.  But it's fine --\n\t\t// it should just point out if they had a pull without mimicry\n\t\tconst playerFilter = filter<Event>().source(this.parser.actor.id)\n\t\tthis.addEventHook(playerFilter.type('statusApply').status(oneOf([\n\t\t\tthis.data.statuses.MIMICRY_TANK.id,\n\t\t\tthis.data.statuses.MIMICRY_HEALER.id,\n\t\t\tthis.data.statuses.MIMICRY_DPS.id,\n\t\t])), this.onApplyMimicry)\n\n\t\tthis.addEventHook('complete', this.onCompleteDefensives)\n\t}\n\n\tprivate onApplyMimicry(event: Events['statusApply']) {\n\t\tthis.currentMimicry = event.status\n\t}\n\n\tprivate onCompleteDefensives() {\n\t\tswitch (this.currentMimicry) {\n\t\tcase this.data.statuses.MIMICRY_TANK.id:\n\t\t\tthis.trackedDefensives.push(\n\t\t\t\tthis.data.actions.DRAGON_FORCE,\n\t\t\t\tthis.data.actions.CHELONIAN_GATE,\n\t\t\t\tthis.data.actions.DEVOUR,\n\t\t\t)\n\t\t\tbreak\n\t\tcase this.data.statuses.MIMICRY_HEALER.id:\n\t\t\tthis.trackedDefensives.push(this.data.actions.ANGELS_SNACK)\n\t\t\tbreak\n\t\tcase this.data.statuses.MIMICRY_DPS.id:\n\t\t\tbreak\n\t\tdefault:\n\t\t\t// No mimicry at all!  This is the first time I would genuinely argue for a\n\t\t\t// \"Morbid\" severity -- essentially missing a 20% damage buff that lasts the\n\t\t\t// entire fight and requires zero resources or upkeep.\n\t\t\tthis.suggestions.add(new Suggestion({\n\t\t\t\ticon: this.data.actions.AETHERIAL_MIMICRY.icon,\n\t\t\t\tcontent: <Trans id=\"blu.mimicry_missing.content\">\n\t\t\t\t\t\tYou did not have any <DataLink action=\"AETHERIAL_MIMICRY\"/> stance on.  This is free damage!\n\t\t\t\t</Trans>,\n\t\t\t\tseverity: SEVERITY.MAJOR,\n\t\t\t\twhy: <Trans id=\"blu.mimicry_missing.why\">No <DataLink status=\"MIMICRY_DPS\"/>, <DataLink status=\"MIMICRY_TANK\"/> or <DataLink status=\"MIMICRY_HEALER\"/>.</Trans>,\n\t\t\t}))\n\t\t\tbreak\n\t\t}\n\t}\n}\n","import {Plural, Trans} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Status} from 'data/STATUSES'\nimport {Event} from 'event'\nimport {filter} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {Actors} from 'parser/core/modules/Actors'\nimport Checklist, {Requirement, TARGET, TieredRule} from 'parser/core/modules/Checklist'\nimport {DoTs as CoreDoTs} from 'parser/core/modules/DoTs'\nimport Suggestions, {SEVERITY, TieredSuggestion} from 'parser/core/modules/Suggestions'\nimport React from 'react'\n\nconst SEVERITIES = {\n\tUNBUFFED_SOT: {\n\t\t1: SEVERITY.MINOR,\n\t},\n\t// Clipping warnings in seconds per minute\n\tCLIPPING: {\n\t\t6000: SEVERITY.MINOR,\n\t\t9000: SEVERITY.MEDIUM,\n\t\t12000: SEVERITY.MAJOR,\n\t},\n\tUPTIME: {\n\t\t90: TARGET.WARN,\n\t\t95: TARGET.SUCCESS,\n\t},\n}\n\nexport class DoTs extends CoreDoTs {\n\t@dependency private myactors!: Actors\n\t@dependency private checklist!: Checklist\n\t@dependency private suggestions!: Suggestions\n\n\tprivate bristleId?: Status['id']\n\tprivate unbuffedSongsOfTorment = 0;\n\n\tprotected override trackedStatuses = [\n\t\tthis.data.statuses.BLEEDING.id,\n\t]\n\n\toverride initialise() {\n\t\tsuper.initialise()\n\n\t\tthis.bristleId = this.data.statuses.BRISTLE.id\n\n\t\tconst playerFilter = filter<Event>().source(this.parser.actor.id)\n\n\t\tthis.addEventHook(playerFilter.type('action').action(this.data.actions.SONG_OF_TORMENT.id), this.onApplyingSoT)\n\t\tthis.addEventHook(filter<Event>().type('complete'), this.onCompleteExtra)\n\n\t}\n\tprivate onApplyingSoT() {\n\t\tif (this.bristleId === undefined) { return }\n\t\tif (this.myactors.current.hasStatus(this.bristleId)) { // Boost effect from Bristle is present\n\t\t\treturn\n\t\t}\n\n\t\t// Bristle was not used, which is a (relatively minor) ~65 potency loss\n\t\tthis.unbuffedSongsOfTorment++\n\t}\n\n\tprivate onCompleteExtra() {\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.SONG_OF_TORMENT.icon,\n\t\t\tcontent: <Trans id = \"blu.song_of_torment.suggestion.unbuffed.content\">\n\t\t\t\tIdeally every <DataLink action=\"SONG_OF_TORMENT\"/> should be buffed by first using <DataLink action=\"BRISTLE\"/>.\n\t\t\t\tThis is a minor potency gain.\n\t\t\t</Trans>,\n\t\t\ttiers: SEVERITIES.UNBUFFED_SOT,\n\t\t\twhy: <Trans id =\"blu.song_of_torment.suggestion.unbuffed.why\">\n\t\t\t\t<Plural value={this.unbuffedSongsOfTorment ?? 0} one=\"# Song of Torment was\" other=\"# Songs of Torment were\"/> not buffed.\n\t\t\t</Trans>,\n\t\t\tvalue: this.unbuffedSongsOfTorment,\n\t\t}))\n\t}\n\n\tprotected override addChecklistRules() {\n\t\tconst uptimePercent = this.getUptimePercent(this.data.statuses.BLEEDING.id)\n\t\tthis.checklist.add(new TieredRule({\n\t\t\tname: <Trans id=\"blu.dots.rule.name\">Keep your DoTs up </Trans>,\n\t\t\tdescription: <Trans id=\"blu.dots.rule.description\">\n\t\t\t\tThe <DataLink status=\"BLEEDING\" showIcon={false} showTooltip={false} /> effect from Nightbloom and SoT is a solid 15% of your total damage.\n\t\t\t</Trans>,\n\t\t\ttiers: SEVERITIES.UPTIME,\n\t\t\trequirements: [\n\t\t\t\tnew Requirement({\n\t\t\t\t\tname: <Trans id=\"blu.dots.requirement.uptime-bleed.name\"><DataLink status=\"BLEEDING\" /> uptime</Trans>,\n\t\t\t\t\tpercent: uptimePercent,\n\t\t\t\t}),\n\t\t\t],\n\t\t}))\n\t}\n\n\tprotected addClippingSuggestions() {\n\t\tconst clippingPerMinute = this.getClippingAmount(this.data.statuses.BLEEDING.id)\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.SONG_OF_TORMENT.icon,\n\t\t\tcontent: <Trans id=\"blu.dots.suggestion.clip-bleed.content\">\n\t\t\t\tAvoid refreshing Song of Torment significantly before its expiration, this will allow you to cast more Sonic Boom.\n\t\t\t</Trans>,\n\t\t\ttiers: SEVERITIES.CLIPPING,\n\t\t\tvalue: clippingPerMinute,\n\t\t\twhy: <Trans id=\"blu.dots.suggestion.clip-bleed.why\">\n\t\t\t\tAn average of {this.parser.formatDuration(clippingPerMinute)} of <DataLink status=\"BLEEDING\" /> clipped per minute due to early refreshes.\n\t\t\t</Trans>,\n\t\t}))\n\t}\n}\n\n","import {Trans, Plural} from '@lingui/react'\nimport {StatusLink} from 'components/ui/DbLink'\nimport STATUSES, {Status} from 'data/STATUSES'\nimport {Event, Events} from 'event'\nimport {Analyser} from 'parser/core/Analyser'\nimport {filter, oneOf} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {Data} from 'parser/core/modules/Data'\nimport Downtime from 'parser/core/modules/Downtime'\nimport Suggestions, {TieredSuggestion, SEVERITY} from 'parser/core/modules/Suggestions'\nimport React from 'react'\n\ninterface buffMisuse {\n\tdropped: number\n\toverwrote: number\n\tduration: number\n}\n\nexport class DroppedBuffs extends Analyser {\n\tstatic override handle = 'droppedbuffs'\n\n\t@dependency private data!: Data\n\t@dependency private suggestions!: Suggestions\n\t@dependency private downtime!: Downtime\n\n\tprivate currentBuffs = new Map<Status['id'], number>()\n\tprivate misusedBuffs : {[key: number]: buffMisuse} = {\n\t\t[STATUSES.BRISTLE.id]: {dropped: 0, overwrote: 0, duration: STATUSES.BRISTLE.duration},\n\t\t[STATUSES.WHISTLE.id]: {dropped: 0, overwrote: 0, duration: STATUSES.WHISTLE.duration},\n\t\t[STATUSES.TINGLING.id]: {dropped: 0, overwrote: 0, duration: STATUSES.TINGLING.duration},\n\t}\n\n\toverride initialise() {\n\t\tconst playerFilter = filter<Event>().source(this.parser.actor.id)\n\t\tconst buffFilter = playerFilter.status(oneOf(Object.keys(this.misusedBuffs).map(Number)))\n\t\tthis.addEventHook(buffFilter.type('statusApply'), this.onGainBuff)\n\t\tthis.addEventHook(buffFilter.type('statusRemove'), this.onRemoveBuff)\n\t\tthis.addEventHook({\n\t\t\ttype: 'death',\n\t\t\tactor: this.parser.actor.id,\n\t\t}, this.onDeath)\n\t\tthis.addEventHook('complete', this.onComplete)\n\t}\n\n\tprivate onRemoveBuff(event: Events['statusRemove']) {\n\t\tif (this.currentBuffs.has(event.status)) {\n\t\t\tconst buffStart = this.currentBuffs.get(event.status) ?? event.timestamp\n\t\t\tconst buffEnd   = event.timestamp\n\t\t\tconst buffDelta = buffEnd - buffStart\n\t\t\tif (buffDelta >= this.misusedBuffs[event.status].duration) {\n\t\t\t\t// Buff expired!\n\t\t\t\tthis.misusedBuffs[event.status].dropped++\n\t\t\t}\n\t\t}\n\t\tthis.currentBuffs.delete(event.status)\n\t}\n\n\tprivate onGainBuff(event: Events['statusApply']) {\n\t\tconst current = this.currentBuffs.get(event.status)\n\t\tthis.currentBuffs.set(event.status, event.timestamp)\n\n\t\tif (current === undefined) {\n\t\t\treturn\n\t\t}\n\n\t\t// Overwrite! Let's ignore it if this is during downtime:\n\t\tconst duringDowntime = this.downtime.getDowntime(event.timestamp - 2, event.timestamp)\n\t\tif (duringDowntime >= 0) {\n\t\t\treturn\n\t\t}\n\n\t\t// Not during downtime, so just an overwrite.\n\t\tthis.misusedBuffs[event.status].overwrote++\n\t}\n\n\tprivate onDeath() {\n\t\tthis.currentBuffs.clear()\n\t}\n\n\tprivate suggestOnDroppedStatus(statusID: Status['id'], droppedStatusCount: number) {\n\t\tconst droppedStatus = this.data.getStatus(statusID)\n\t\tif (droppedStatus === undefined) { return }\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: droppedStatus.icon,\n\t\t\tcontent: <Trans id=\"blu.droppedbuffs.suggestions.dropped.content\" >\n\t\t\t\t<StatusLink {...droppedStatus} /> fell off without being used.\n\t\t\t</Trans>,\n\t\t\ttiers: {1: SEVERITY.MEDIUM},\n\t\t\tvalue: droppedStatusCount,\n\t\t\twhy: <Trans id=\"blu.droppedbuffs.suggestions.dropped.why\" >\n\t\t\t\t<Plural value={droppedStatusCount ?? 0} one=\"# Use of \" other=\"# Uses of \"/> <StatusLink {...droppedStatus} showIcon={false} /> expired.\n\t\t\t</Trans>,\n\t\t}))\n\t}\n\n\tprivate suggestOnOverwrittenStatus(statusID: Status['id'], overwrittenStatusCount: number) {\n\t\tconst overwrittenStatus = this.data.getStatus(statusID)\n\t\tif (overwrittenStatus === undefined) { return }\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: overwrittenStatus.icon,\n\t\t\tcontent: <Trans id=\"blu.droppedbuffs.suggestions.overwritten.content\" >\n\t\t\t\t<StatusLink {...overwrittenStatus} /> was overwritten.\n\t\t\t</Trans>,\n\t\t\ttiers: {1: SEVERITY.MEDIUM},\n\t\t\tvalue: overwrittenStatusCount,\n\t\t\twhy: <Trans id=\"blu.droppedbuffs.suggestions.overwritten.why\" >\n\t\t\t\t<Plural value={overwrittenStatusCount ?? 0} one=\"# Use of \" other=\"# Uses of \"/> <StatusLink {...overwrittenStatus} showIcon={false} /> were overwritten.\n\t\t\t</Trans>,\n\t\t}))\n\t}\n\n\tprivate onComplete() {\n\t\tObject.keys(this.misusedBuffs).map(Number).forEach(statusID => {\n\t\t\tthis.suggestOnDroppedStatus(statusID, this.misusedBuffs[statusID].dropped)\n\t\t\tthis.suggestOnOverwrittenStatus(statusID, this.misusedBuffs[statusID].overwrote)\n\t\t})\n\t}\n}\n","import {CooldownDowntime} from 'parser/core/modules/CooldownDowntime'\n\nconst DEFAULT_ALLOWED_DOWNTIME = 1000\nexport class GeneralCDDowntime extends CooldownDowntime {\n\toverride defaultAllowedAverageDowntime = DEFAULT_ALLOWED_DOWNTIME\n\n\toverride trackedCds = [\n\t\t{\n\t\t\tcooldowns: [this.data.actions.NIGHTBLOOM],\n\t\t\tfirstUseOffset: 5000,\n\t\t},\n\t\t{\n\t\t\tcooldowns: [this.data.actions.PHANTOM_FLURRY],\n\t\t\tfirstUseOffset: 19000,\n\t\t},\n\t\t{\n\t\t\tcooldowns: [this.data.actions.FEATHER_RAIN, this.data.actions.ERUPTION],\n\t\t\tfirstUseOffset: 15000,\n\t\t},\n\t\t{\n\t\t\tcooldowns: [this.data.actions.SHOCK_STRIKE],\n\t\t\tfirstUseOffset: 15000,\n\t\t},\n\t\t{\n\t\t\tcooldowns: [this.data.actions.GLASS_DANCE],\n\t\t\tfirstUseOffset: 12500,\n\t\t\tallowedAverageDowntime: 30000, // DPS gain to hold this until the Moon Flute window\n\t\t},\n\t\t{\n\t\t\tcooldowns: [this.data.actions.J_KICK, this.data.actions.QUASAR],\n\t\t\tfirstUseOffset: 2500,\n\t\t},\n\t\t{\n\t\t\tcooldowns: [this.data.actions.TRIPLE_TRIDENT],\n\t\t\tfirstUseOffset: 2500,\n\t\t\tallowedAverageDowntime: 30000, // DPS gain for Crit builds to hold this until the Moon Flute window\n\t\t},\n\t\t{\n\t\t\tcooldowns: [this.data.actions.THE_ROSE_OF_DESTRUCTION],\n\t\t\tfirstUseOffset: 5000,\n\t\t},\n\t\t{\n\t\t\tcooldowns: [this.data.actions.COLD_FOG],\n\t\t\tfirstUseOffset: 30000, // some time after the opener\n\t\t},\n\t\t{\n\t\t\tcooldowns: [\n\t\t\t\tthis.data.actions.OFF_GUARD,\n\t\t\t\tthis.data.actions.PECULIAR_LIGHT,\n\t\t\t],\n\t\t\tfirstUseOffset: 50000, // up to 50 seconds into the pull, if people are staggering their buffs\n\t\t},\n\t]\n\toverride suggestionOnlyCooldowns = [\n\t\t{cooldowns: [this.data.actions.MATRA_MAGIC]},\n\t\t{cooldowns: [this.data.actions.DRAGON_FORCE]},\n\t\t{cooldowns: [this.data.actions.ANGELS_SNACK]},\n\t]\n}\n","import {Trans} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Interrupts as CoreInterrupts} from 'parser/core/modules/Interrupts'\nimport React from 'react'\nimport {DISPLAY_ORDER} from './DISPLAY_ORDER'\n\nexport class Interrupts extends CoreInterrupts {\n\tstatic override displayOrder = DISPLAY_ORDER.INTERRUPTED_CASTS\n\toverride suggestionContent = <Trans id=\"blu.interrupts.suggestion.content\">\n\t\tBlue Mage has few movement tools; our <DataLink action=\"SWIFTCAST\"/> will either be used during the <DataLink action=\"MOON_FLUTE\"/> window, or be left in reserve for a resurrect.  In very select circumstances <DataLink action=\"COLD_FOG\"/> can be used to get 15 seconds of free movement, but this is rare.  Generally, you will want to pre-position and use slidecast windows as much as you can.\n\t</Trans>\n}\n\n","import {t} from '@lingui/macro'\nimport {Plural, Trans} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Event, Events} from 'event'\nimport {Analyser} from 'parser/core/Analyser'\nimport {EventHook} from 'parser/core/Dispatcher'\nimport {filter} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {Data} from 'parser/core/modules/Data'\nimport Suggestions, {SEVERITY, TieredSuggestion} from 'parser/core/modules/Suggestions'\nimport React from 'react'\n\nexport class MightyGuardGCDing extends Analyser {\n\tstatic override handle = 'mightyguard'\n\tstatic override title = t('blu.mighty_guard.title')`Mighty Guard`\n\n\t@dependency private data!: Data\n\t@dependency private suggestions!: Suggestions\n\n\tprivate hasTankMimickry = false\n\tprivate damagingActionsUnderMG = 0\n\tprivate currentHook?: EventHook<Events['action']>\n\n\toverride initialise() {\n\t\tsuper.initialise()\n\t\tconst playerFilter = filter<Event>().source(this.parser.actor.id)\n\n\t\tconst tankMimickryFilter = playerFilter.status(this.data.statuses.MIMICRY_TANK.id)\n\t\tthis.addEventHook(tankMimickryFilter.type('statusApply'), this.onApplyTankMimickry)\n\t\tthis.addEventHook(tankMimickryFilter.type('statusRemove'), this.onRemoveTankMimickry)\n\n\t\tconst mightyGuardFilter = playerFilter.status(this.data.statuses.MIGHTY_GUARD.id)\n\t\tthis.addEventHook(mightyGuardFilter.type('statusApply'), this.onApplyMightyGuard)\n\t\tthis.addEventHook(mightyGuardFilter.type('statusRemove'), this.onRemoveMightyGuard)\n\n\t\tthis.addEventHook('complete', this.onComplete)\n\t}\n\n\tprivate onApplyTankMimickry() {\n\t\tthis.hasTankMimickry = true\n\t}\n\tprivate onRemoveTankMimickry() {\n\t\tthis.hasTankMimickry = false\n\t}\n\n\tprivate onApplyMightyGuard() {\n\t\tif (this.currentHook !== undefined) { return }\n\t\tconst playerFilter = filter<Event>().source(this.parser.actor.id)\n\t\tthis.currentHook = this.addEventHook(playerFilter.type('action'), this.onActionWithStance)\n\t}\n\n\tprivate onRemoveMightyGuard() {\n\t\tif (this.currentHook !== undefined) {\n\t\t\tthis.removeEventHook(this.currentHook)\n\t\t}\n\t}\n\n\tprivate onActionWithStance(event: Events['action']) {\n\t\t// If they have tank mimickry, we expect them to have MG up.  If they want to stance\n\t\t// dance, all the glory to them.\n\t\tif (this.hasTankMimickry) { return }\n\n\t\t// No mimickry. See if this was a damaging action\n\t\tconst action = this.data.getAction(event.action)\n\t\tif (action === undefined || action === null) { return }\n\n\t\tif (action.damageType === undefined) { return }\n\n\t\t// Damaging action under MG. Count it!\n\t\tthis.damagingActionsUnderMG++\n\t}\n\n\tprivate onComplete() {\n\t\tconst gcds = this.damagingActionsUnderMG\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.MIGHTY_GUARD.icon,\n\t\t\tcontent: <Trans id=\"blu.mighty_guard.gcds.content\">\n\t\t\t\t<DataLink action=\"MIGHTY_GUARD\"/> comes with a significant damage penalty; If you don't need it to survive a mechanic, turn it off!\n\t\t\t</Trans>,\n\t\t\ttiers: {1: SEVERITY.MINOR},\n\t\t\tvalue: gcds,\n\t\t\twhy: <Trans id=\"blu.mighty_guard.gcds.why\">\n\t\t\t\t<Plural value={gcds ?? 0} one=\"# damaging GCD\" other=\"# damaging GCDs\" /> were cast under <DataLink action=\"MIGHTY_GUARD\" />\n\t\t\t</Trans>,\n\t\t}))\n\t}\n}\n","import {t} from '@lingui/macro'\nimport {Trans} from '@lingui/react'\nimport {ActionLink} from 'components/ui/DbLink'\nimport {RotationTargetOutcome} from 'components/ui/RotationTable'\nimport {Action} from 'data/ACTIONS'\nimport {Event} from 'event'\nimport {filter} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {BuffWindow, EvaluatedAction, TrackedAction, ExpectedActionsEvaluator, ExpectedGcdCountEvaluator} from 'parser/core/modules/ActionWindow'\nimport {HistoryEntry} from 'parser/core/modules/ActionWindow/History'\nimport {Cooldowns} from 'parser/core/modules/Cooldowns'\nimport {GlobalCooldown} from 'parser/core/modules/GlobalCooldown'\nimport {SEVERITY} from 'parser/core/modules/Suggestions'\nimport React from 'react'\nimport {DISPLAY_ORDER} from './DISPLAY_ORDER'\n\nconst SEVERITIES = {\n\tMISSING_EXPECTED_USES: {\n\t\t1: SEVERITY.MINOR,\n\t\t2: SEVERITY.MEDIUM,\n\t\t3: SEVERITY.MAJOR,\n\t},\n\n\tTOO_FEW_GCDS: {\n\t\t8: SEVERITY.MAJOR,\n\t},\n}\n\nconst EXPECTED_GCD_COUNT = 5\n// Some notes on the expected GCD count.\n// Waxing Nocturne is 15 seconds, so that seems like\n// it should be 6 GCDs, but the first .5 seconds you are still\n// in GCD recast time, so it's more like 14.5 seconds.\n//\n// If you are running very high spell speed, it is actually\n// possible to get those 6 GCDs, but that's not the entire story!\n//\n// If you just cats Moon Flute and then do 6 GCDs, then no matter\n// how strong those GCDs are -- even if they are 6 Revenge Blasts --\n// it will be a potency loss compared to 6 Revenge Blasts + 6 Sonic Booms.\n//\n// So while GCDs are as usual important, the big deal in a Moon Flute\n// window is weaving in as many oGCDs as we can *without* dropping a\n// GCD cast.\n//\n// And so our standard moon flute window actually only has us cast 4\n// GCDs (Triple Trident, The Rose of Destruction, Bristle, Matra Magic)\n// while giving up ~5 seconds to purposely clipping with oGCDs;\n// 3.6 seconds of Surpanakha, and the rest is all hard clips and\n// purposeful multi-weaves.\n//\n// ...but for implementation details, Phantom Flurry is marked as a GCD,\n// so even though we technically only do 4 GCDs in the window, we are\n// looking for a pseudo-5th, Phantom Flurry.\n//\n// Also, if they used Final Sting, then we window can be as short as a single\n// GCD!\nconst neutralOrPositiveOutcome = (actual: number, expected?: number) => {\n\tif (expected !== undefined && actual === expected) {\n\t\treturn RotationTargetOutcome.POSITIVE\n\t}\n\treturn RotationTargetOutcome.NEUTRAL\n}\n\nexport class MoonFlute extends BuffWindow {\n\tstatic override handle = 'moonflutes'\n\tstatic override title = t('blu.moonflutes.title')`Moon Flute Windows`\n\tstatic override displayOrder = DISPLAY_ORDER.MOON_FLUTE\n\n\t@dependency globalCooldown!: GlobalCooldown\n\t@dependency private cooldowns!: Cooldowns\n\n\toverride buffStatus = this.data.statuses.WAXING_NOCTURNE\n\n\tprivate windowMissedTT = new Set<number>()\n\n\toverride initialise() {\n\t\tsuper.initialise()\n\n\t\t// Add a Waning Moon hook, essentially telling us exactly when a MF window ended.\n\t\tconst extraFilter = filter<Event>().source(this.parser.actor.id).type('statusApply')\n\t\t\t.status(this.data.statuses.WANING_NOCTURNE.id)\n\t\tthis.addEventHook(extraFilter, this.onWaningNocturneApply)\n\n\t\tconst suggestionIcon = this.data.actions.MOON_FLUTE.icon\n\t\tconst suggestionWindowName = <ActionLink action=\"MOON_FLUTE\" showIcon={false}/>\n\t\tthis.addEvaluator(new ExpectedGcdCountEvaluator({\n\t\t\texpectedGcds: EXPECTED_GCD_COUNT, // 4 GCDs + Phantom Flurry _or_ 5 GCDs\n\t\t\tglobalCooldown: this.globalCooldown,\n\t\t\tsuggestionIcon,\n\t\t\tsuggestionContent: <Trans id=\"blu.moonflutes.suggestions.gcds.content\">\n\t\t\t\tRegardless of spell speed, ideally a <ActionLink action=\"MOON_FLUTE\" /> window should contain at least\n\t\t\t\t\t4 GCDs and end in <ActionLink action=\"PHANTOM_FLURRY\" />.  If you have higher latency this can\n\t\t\t\t\tbe problematic; changing your speed speed might help, and in a pinch you can try moving certain\n\t\t\t\t\toGCDs out of the window (<ActionLink action=\"J_KICK\" />, <ActionLink action=\"GLASS_DANCE\" />,\n\t\t\t\t<ActionLink action=\"FEATHER_RAIN\" />), or replacing <ActionLink action=\"THE_ROSE_OF_DESTRUCTION\" />\n\t\t\t\t\twith a <ActionLink action=\"SONIC_BOOM\" />.\n\t\t\t</Trans>,\n\t\t\tsuggestionWindowName,\n\t\t\tseverityTiers: SEVERITIES.TOO_FEW_GCDS,\n\t\t\thasStacks: false,\n\t\t\tadjustCount: this.adjustExpectedGcdCount.bind(this),\n\t\t}))\n\n\t\tconst mfActionEvaluator = new MoonFluteExpectedActionsEvaluator({\n\t\t\texpectedActions: [\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.J_KICK,\n\t\t\t\t\texpectedPerWindow: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.TRIPLE_TRIDENT,\n\t\t\t\t\texpectedPerWindow: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.NIGHTBLOOM,\n\t\t\t\t\texpectedPerWindow: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.THE_ROSE_OF_DESTRUCTION,\n\t\t\t\t\texpectedPerWindow: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.SHOCK_STRIKE,\n\t\t\t\t\texpectedPerWindow: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.BRISTLE,\n\t\t\t\t\texpectedPerWindow: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.GLASS_DANCE,\n\t\t\t\t\texpectedPerWindow: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.SURPANAKHA,\n\t\t\t\t\texpectedPerWindow: 4,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.FEATHER_RAIN,\n\t\t\t\t\texpectedPerWindow: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.MATRA_MAGIC,\n\t\t\t\t\texpectedPerWindow: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\taction: this.data.actions.PHANTOM_FLURRY,\n\t\t\t\t\texpectedPerWindow: 1,\n\t\t\t\t},\n\t\t\t],\n\t\t\tsuggestionIcon,\n\t\t\tsuggestionContent: <Trans id=\"blu.moonflutes.suggestions.expected-actions.content\">\n\t\t\t\t<ActionLink action=\"MOON_FLUTE\" /> is only worth using if the buffed actions during the window\n\t\t\t\twill give you an extra 1260 potency (equivalent to casting <ActionLink action=\"SONIC_BOOM\" /> six times).\n\t\t\t\tThe more of your larger cooldowns you can fit into the window, the better the result.  High-priority targets\n\t\t\t\tare <ActionLink action=\"NIGHTBLOOM\" />, and finishing the combo with a <ActionLink action=\"PHANTOM_FLURRY\" />.\n\t\t\t</Trans>,\n\t\t\tsuggestionWindowName,\n\t\t\tseverityTiers: SEVERITIES.MISSING_EXPECTED_USES,\n\t\t\tadjustOutcome: this.adjustExpectedActionOutcome.bind(this),\n\t\t})\n\t\tmfActionEvaluator.setAltAction(this.data.actions.FEATHER_RAIN, this.data.actions.ERUPTION)\n\t\tmfActionEvaluator.setAltAction(this.data.actions.SHOCK_STRIKE, this.data.actions.BLU_MOUNTAIN_BUSTER)\n\t\tmfActionEvaluator.setAltAction(this.data.actions.J_KICK, this.data.actions.QUASAR)\n\t\tthis.addEvaluator(mfActionEvaluator)\n\t}\n\n\tprivate onWaningNocturneApply() {\n\t\t// This will be 0 if TT is available, and some number of milliseconds otherwise\n\t\tconst ttCd = this.cooldowns.remaining('TRIPLE_TRIDENT')\n\t\tif (ttCd > 0) { return }\n\n\t\t// They just finished a MF window and TT was available.  This is a Big Loss(tm);\n\t\t// for Spell Speed builds this means they missed aligning their TT with the 6m\n\t\t// MF window, and for Crit builds they just lost a ton of damage.\n\t\tconst current = this.history.getCurrent()\n\t\tif (current == null) { return }\n\t\tthis.windowMissedTT.add(current.start)\n\t}\n\n\tprivate adjustExpectedGcdCount(window: HistoryEntry<EvaluatedAction[]>) {\n\t\tconst finalStingUsed = window.data.filter(event => (event.action.id === this.data.actions.FINAL_STING.id || event.action.id === this.data.actions.SELF_DESTRUCT.id)).length\n\t\treturn finalStingUsed >= 1 ? (-window.data.length+1) : 0\n\t}\n\n\tprivate adjustExpectedActionOutcome(window: HistoryEntry<EvaluatedAction[]>, trackedAction: TrackedAction) {\n\t\tconst finalStingUsed = window.data.filter(event => (event.action.id === this.data.actions.FINAL_STING.id || event.action.id === this.data.actions.SELF_DESTRUCT.id)).length\n\t\tif (finalStingUsed === 0) {\n\t\t\t// Final Sting not used here\n\t\t\tif (trackedAction.action.id === this.data.actions.TRIPLE_TRIDENT.id) {\n\t\t\t\t// Using TT on cooldown, on a long enough timeline, can be a DPS gain over\n\t\t\t\t// holding it for a MF window, particularly for SpS builds.\n\t\t\t\t// So let's be understanding -- We only dock points if they were in a\n\t\t\t\t// Moon Flute window, had TT available, and didn't use it.\n\t\t\t\tif (!this.windowMissedTT.has(window.start)) {\n\t\t\t\t\t// TT was either used, or wasn't available during the window.\n\t\t\t\t\t// Either way, this check will either be a Positive or a Neutral,\n\t\t\t\t\t// never a negative.\n\t\t\t\t\treturn neutralOrPositiveOutcome\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Default handling:\n\t\t\treturn\n\t\t}\n\n\t\t// Final Sting used, so don't dock any points for missed actions:\n\t\treturn neutralOrPositiveOutcome\n\t}\n}\n\nclass MoonFluteExpectedActionsEvaluator extends ExpectedActionsEvaluator {\n\tprivate altActions = new Map<Action['id'], Action>()\n\tprivate foundAltActions = new Map<Action['id'], Action>()\n\n\tpublic setAltAction(action: Action, altAction: Action) {\n\t\tthis.altActions.set(action.id, altAction)\n\t}\n\n\t// Just a small subclass that handles our alternative actions.\n\toverride countUsed(window: HistoryEntry<EvaluatedAction[]>, action: TrackedAction) {\n\t\tconst altAction = this.altActions.get(action.action.id)\n\t\tif (altAction !== undefined) {\n\t\t\tconst altActionID = altAction.id\n\t\t\tconst foundAlt = window.data.filter(cast => cast.action.id === altActionID).length\n\t\t\tif (foundAlt > 0) {\n\t\t\t\tthis.foundAltActions.set(action.action.id, altAction)\n\t\t\t\treturn foundAlt\n\t\t\t}\n\t\t}\n\n\t\treturn super.countUsed(window, action)\n\t}\n\n\toverride actionHeader(action: TrackedAction) {\n\t\tconst foundAlt = this.foundAltActions.get(action.action.id)\n\t\tif (foundAlt === undefined) {\n\t\t\treturn super.actionHeader(action)\n\t\t}\n\n\t\t// We have alternative actions used\n\t\treturn <ActionLink showName={false} {...foundAlt}/>\n\t}\n}\n\n","import {Trans} from '@lingui/react'\nimport ACTIONS from 'data/ACTIONS'\nimport {Event, Events} from 'event'\nimport {filter} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {Actors} from 'parser/core/modules/Actors'\nimport {Overheal, SuggestedColors} from 'parser/core/modules/Overheal'\nimport React from 'react'\n\nexport class BLUOverheal extends Overheal {\n\n\t@dependency private actors!: Actors\n\n\toverride checklistRuleBreakout = true\n\toverride displayPieChart = true\n\toverride displaySuggestion = true\n\toverride suggestionIcon = ACTIONS.POM_CURE.icon\n\n\toverride trackedHealCategories = [\n\t\t{\n\t\t\tname: <Trans id=\"blu.overheal.hot.name\">Healing Over Time</Trans>,\n\t\t\tcolor: SuggestedColors[1], // 0 is used for \"Direct\"\n\t\t\ttrackedHealIds: [\n\t\t\t\tthis.data.statuses.ANGELS_SNACK.id,\n\t\t\t\tthis.data.actions.ANGELS_SNACK.id,\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: <Trans id=\"blu.overheal.aoe.name\">AoE</Trans>,\n\t\t\tcolor: SuggestedColors[2],\n\t\t\ttrackedHealIds: [\n\t\t\t\tthis.data.actions.STOTRAM.id,\n\t\t\t\tthis.data.actions.EXUVIATION.id,\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tname: <Trans id=\"blu.overheal.white_wind.name\">White Wind</Trans>,\n\t\t\tcolor: SuggestedColors[3],\n\t\t\ttrackedHealIds: [\n\t\t\t\tthis.data.actions.WHITE_WIND.id,\n\t\t\t],\n\t\t},\n\t]\n\n\toverride initialise() {\n\t\t// the eventhooks look like a FIFO but might as well just add\n\t\t// this hook twice in case it also behaves like a LIFO in some\n\t\t// scenario.\n\t\tthis.addEventHook(filter<Event>().type('complete'), this.onCompleteExtra)\n\t\tsuper.initialise()\n\t\tthis.addEventHook(filter<Event>().type('complete'), this.onCompleteExtra)\n\t}\n\n\toverride considerHeal(event: Events['heal'], _pet: boolean = false): boolean {\n\t\t// Filter out Devour; it's going to be used on cooldown by tanks, and either\n\t\t// as a DPS button or occasionally as a mechanic button (e.g. A8S Gavel)\n\t\tif (event.cause.type === 'action') {\n\t\t\treturn event.cause.action !== this.data.actions.DEVOUR.id\n\t\t}\n\t\treturn true\n\t}\n\n\tprivate onCompleteExtra() {\n\t\t// Ideally we only run the Overheal report if the person has Healer mimickry,\n\t\t// but detection of the status is finicky since it's a stance that people\n\t\t// normally get before even going into the instance.\n\n\t\t// So let's instead just check if they did any sort of non-White Wind healing\n\t\tconst nonWWhealing = this.direct.heal + this.trackedOverheals.reduce((acc, entry) => {\n\t\t\tif (entry.idIsTracked(this.data.actions.WHITE_WIND.id)) {\n\t\t\t\treturn acc\n\t\t\t}\n\t\t\treturn acc + entry.heal\n\t\t}, 0)\n\n\t\tif (nonWWhealing !== 0) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.checklistRuleBreakout = false\n\t\tthis.displayPieChart = false\n\t\tthis.displaySuggestion = false\n\t\tthis.displayChecklist = false\n\t\tthis.checklistRuleBreakout = false\n\t}\n}\n","import {t} from '@lingui/macro'\nimport {Plural, Trans} from '@lingui/react'\nimport {ActionLink, DataLink} from 'components/ui/DbLink'\nimport {RotationTable, RotationTableEntry} from 'components/ui/RotationTable'\nimport {Event, Events} from 'event'\nimport {Analyser} from 'parser/core/Analyser'\nimport {EventHook} from 'parser/core/Dispatcher'\nimport {filter, oneOf} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {History} from 'parser/core/modules/ActionWindow/History'\nimport {Actors} from 'parser/core/modules/Actors'\nimport {Data} from 'parser/core/modules/Data'\nimport Downtime from 'parser/core/modules/Downtime'\nimport {GlobalCooldown} from 'parser/core/modules/GlobalCooldown'\nimport Suggestions, {SEVERITY, TieredSuggestion} from 'parser/core/modules/Suggestions'\nimport {Timeline} from 'parser/core/modules/Timeline'\nimport React, {Fragment} from 'react'\nimport {Message} from 'semantic-ui-react'\nimport {DISPLAY_ORDER} from './DISPLAY_ORDER'\n\n// Teechnicaly it's 20% but at 18% HP the HP next regen tick will move you past\n// the window, so give it a bit of a fuzz\nconst REVENGE_BLAST_PERCENT = 0.20\nconst REVENGE_BLAST_WINDOW_PERCENT = 0.18\nconst REVENGE_BLAST_MINIMUM_WINDOW_MS = 5000\n\nconst REVENGE_BLAST_CAST_TIME = 2000\nconst SLIDECAST_OFFSET = 500\n\n// Tiered suggestion severities\nconst REVENGE_SEVERITY = {\n\tWINDOW_MISSED: {\n\t\t1: SEVERITY.MINOR,\n\t\t2: SEVERITY.MINOR,\n\t\t3: SEVERITY.MAJOR,\n\t},\n\tCAST_OUT_OF_WINDOW: {\n\t\t1: SEVERITY.MAJOR,\n\t},\n\tUNWHISTLED_OPENING_REVENGE_BLAST: {\n\t\t1: SEVERITY.MINOR,\n\t},\n}\n\ninterface RevengeBlastWindow {\n\tevents: Array<Events['action']>,\n\thadWhistle: boolean,\n\thadRevengeBlast: boolean,\n}\n\nexport class RevengeBlast extends Analyser {\n\tstatic override handle = 'revengeblast'\n\tstatic override title = t('blu.revenge_blast.title')`Revenge Blast Windows`\n\tstatic override displayOrder = DISPLAY_ORDER.REVENGE_BLAST\n\n\t@dependency private actors!: Actors\n\t@dependency private data!: Data\n\t@dependency private suggestions!: Suggestions\n\t@dependency private timeline!: Timeline\n\t@dependency private downtime!: Downtime\n\t@dependency private gcd!: GlobalCooldown\n\n\tprivate badRevengeBlasts = 0\n\tprivate inRevengeBlastWindow = false\n\tprivate revengeBlastWindows = new History<RevengeBlastWindow>(\n\t\t() => ({\n\t\t\tevents: [],\n\t\t\thadWhistle: false,\n\t\t\thadRevengeBlast: false,\n\t\t})\n\t)\n\tprivate actionHook?: EventHook<Events['action']>\n\n\toverride initialise() {\n\t\tsuper.initialise()\n\n\t\tconst playerFilter = filter<Event>().source(this.parser.actor.id)\n\t\tthis.addEventHook(playerFilter.type('action').action(this.data.actions.REVENGE_BLAST.id), this.onRevengeBlast)\n\t\tthis.addEventHook(playerFilter.type(oneOf(['heal', 'damage'])), this.onActorUpdate)\n\t\tthis.addEventHook(filter<Event>().type('actorUpdate').actor(this.parser.actor.id), this.onActorUpdate)\n\t\tthis.addEventHook({\n\t\t\ttype: 'death',\n\t\t\tactor: this.parser.actor.id,\n\t\t}, this.onActorUpdate)\n\n\t\tthis.addEventHook('complete', this.onComplete)\n\t}\n\n\tprivate onActorUpdate(event: Event) {\n\t\tconst revengeBlastThreshold = this.actors.current.hp.maximum * REVENGE_BLAST_WINDOW_PERCENT\n\n\t\t// TODO: check if we are in a downtime window\n\n\t\tif ((this.actors.current.hp.current > 0) && (this.actors.current.hp.current < revengeBlastThreshold)) {\n\t\t\tif (this.inRevengeBlastWindow) { return }\n\t\t\tthis.inRevengeBlastWindow = true\n\t\t\tthis.revengeBlastWindows.openNew(event.timestamp)\n\t\t\tif (this.actionHook == null) {\n\t\t\t\tthis.actionHook = this.addEventHook(filter<Event>().source(this.parser.actor.id).type('action'), this.onRevengeBlastWindow)\n\t\t\t}\n\t\t} else {\n\t\t\tif (!this.inRevengeBlastWindow) { return }\n\t\t\tthis.inRevengeBlastWindow = false\n\t\t\tthis.revengeBlastWindows.closeCurrent(event.timestamp)\n\t\t\tif (this.actionHook != null) {\n\t\t\t\tthis.removeEventHook(this.actionHook)\n\t\t\t\tthis.actionHook = undefined\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onRevengeBlastWindow(event: Events['action']) {\n\t\tthis.revengeBlastWindows.doIfOpen(current => {\n\t\t\tif (!current.hadRevengeBlast && event.action === this.data.actions.REVENGE_BLAST.id) {\n\t\t\t\tif (this.actors.current.hasStatus(this.data.statuses.WHISTLE.id)) {\n\t\t\t\t\tcurrent.hadWhistle = true\n\t\t\t\t}\n\t\t\t\tcurrent.hadRevengeBlast = true\n\t\t\t}\n\t\t\tcurrent.events.push(event)\n\t\t})\n\t}\n\n\tprivate onRevengeBlast() {\n\t\tconst revengeBlastThreshold = this.actors.current.hp.maximum * REVENGE_BLAST_PERCENT\n\t\tif (this.actors.current.hp.current > revengeBlastThreshold) {\n\t\t\tthis.badRevengeBlasts++\n\t\t}\n\t}\n\n\tprivate onComplete() {\n\t\tthis.revengeBlastWindows.closeCurrent(this.parser.pull.timestamp + this.parser.pull.duration)\n\n\t\t// Revenge Blasts that happened above the HP threshold.\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.REVENGE_BLAST.icon,\n\t\t\tcontent: <Trans id=\"blu.revenge_blast.bad.content\">\n\t\t\t\tOnly use <DataLink action=\"REVENGE_BLAST\" /> if your HP will be below 20% by the time the slidecast window starts.\n\t\t\t</Trans>,\n\t\t\ttiers: REVENGE_SEVERITY.CAST_OUT_OF_WINDOW,\n\t\t\tvalue: this.badRevengeBlasts,\n\t\t\twhy: <Trans id=\"blu.revenge_blast.bad.why\">\n\t\t\t\t<Plural value={this.badRevengeBlasts ?? 0} one=\"# Revenge Blast cast\" other=\"# Revenge Blast casts\" /> happened when above 20% HP\n\t\t\t</Trans>,\n\t\t}))\n\n\t\t// If you know a Revenge Blast window is coming, using Whistle first is a DPS gain.\n\t\tconst unwhistledWindows: number = this.revengeBlastWindows.entries\n\t\t\t.filter(revengeWindow => revengeWindow.data.hadRevengeBlast && !revengeWindow.data.hadWhistle)\n\t\t\t.length\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.REVENGE_BLAST.icon,\n\t\t\tcontent: <Trans id=\"blu.revenge_blast.unwhistled.content\">\n\t\t\t\tIf it won't drop a <DataLink action=\"REVENGE_BLAST\" /> cast, you should cast <DataLink action=\"WHISTLE\" /> before entering a <DataLink action=\"REVENGE_BLAST\" showIcon={false} /> window for a DPS gain over using your filler.\n\t\t\t</Trans>,\n\t\t\ttiers: REVENGE_SEVERITY.UNWHISTLED_OPENING_REVENGE_BLAST,\n\t\t\tvalue: unwhistledWindows,\n\t\t\twhy: <Trans id=\"blu.revenge_blast.unwhistled.why\">\n\t\t\t\t<Plural value={unwhistledWindows ?? 0} one=\"# Revenge Blast window\" other=\"# Revenge Blast windows\" /> did not have the <DataLink action=\"WHISTLE\" /> buff.\n\t\t\t</Trans>,\n\t\t}))\n\t}\n\n\toverride output() {\n\t\tif (this.revengeBlastWindows.entries.length === 0) { return undefined }\n\n\t\tconst gcdHeader = {\n\t\t\theader: <Trans id=\"blu.revenge_blast.rotation-table.header.blast-count\">Revenge Blasts</Trans>,\n\t\t\taccessor: 'gcds',\n\t\t}\n\n\t\tconst gcd = this.gcd.getDuration() / 1000\n\t\tconst revengeBlastID = this.data.actions.REVENGE_BLAST.id\n\t\tconst dat = this.data\n\t\tconst downtime = this.downtime\n\t\tconst rotationData: RotationTableEntry[] = []\n\t\tthis.revengeBlastWindows.entries\n\t\t\t.filter(revengeWindow => ((revengeWindow.end ?? revengeWindow.start) - revengeWindow.start) > REVENGE_BLAST_MINIMUM_WINDOW_MS)\n\t\t\t.forEach(revengeWindow => {\n\t\t\t\tconst revengeStart = revengeWindow.start - this.parser.pull.timestamp - REVENGE_BLAST_CAST_TIME + SLIDECAST_OFFSET\n\t\t\t\tconst revengeEnd   = (revengeWindow.end ?? revengeWindow.start) - this.parser.pull.timestamp - REVENGE_BLAST_CAST_TIME + SLIDECAST_OFFSET\n\t\t\t\tconst forcedDowntime = downtime.getDowntime(\n\t\t\t\t\trevengeWindow.start,\n\t\t\t\t\trevengeWindow.end ?? revengeWindow.start,\n\t\t\t\t)\n\t\t\t\t// TODO: this is a cop-out.  Dealing with downtime is hard.\n\t\t\t\tif (forcedDowntime > REVENGE_BLAST_MINIMUM_WINDOW_MS) { return }\n\n\t\t\t\tconst deltaMs      = revengeEnd - revengeStart - forcedDowntime\n\t\t\t\tif (deltaMs < REVENGE_BLAST_MINIMUM_WINDOW_MS) { return }\n\n\t\t\t\tconst expectedGCDs = Math.floor(deltaMs / 1000 / gcd)\n\t\t\t\tconst tableEntry: RotationTableEntry = {\n\t\t\t\t\tstart: revengeStart,\n\t\t\t\t\tend: revengeEnd,\n\t\t\t\t\ttargetsData: {\n\t\t\t\t\t\tgcds: {\n\t\t\t\t\t\t\tactual: revengeWindow.data.events.filter(e => dat.getAction(e.action)?.id === revengeBlastID).length,\n\t\t\t\t\t\t\texpected: expectedGCDs,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\trotation: revengeWindow.data.events.map(event => ({action: event.action})),\n\t\t\t\t}\n\t\t\t\trotationData.push(tableEntry)\n\t\t\t})\n\n\t\tif (rotationData.length === 0) { return }\n\n\t\treturn <Fragment>\n\t\t\t<Message>\n\t\t\t\t<Trans id=\"blu.revenge_blast.table.message\">Finding windows to safely use <ActionLink action=\"REVENGE_BLAST\"/> is always a good idea.  Even small windows of two GCDs can be attractive -- If you fumble the timing and the second cast only does 50 potency, it is still a DPS gain over casting a filler GCD twice.</Trans>\n\t\t\t</Message>\n\t\t\t<RotationTable\n\t\t\t\ttargets={[gcdHeader]}\n\t\t\t\tdata={rotationData}\n\t\t\t\tonGoto={this.timeline.show}\n\t\t\t/>\n\t\t</Fragment>\n\t}\n}\n\n","import STATUSES from 'data/STATUSES'\nimport {StatusTimeline as CoreStatusTimeline} from 'parser/core/modules/StatusTimeline'\n\nexport class StatusTimeline extends CoreStatusTimeline {\n\tstatic override statusesStackMapping = {\n\t\t[STATUSES.BAD_BREATH_POISON.id]: STATUSES.MALODOROUS.id,\n\t\t[STATUSES.WANING_NOCTURNE.id]: STATUSES.WAXING_NOCTURNE.id,\n\t}\n}\n","import {Trans} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Swiftcast as CoreSwiftcast} from 'parser/core/modules/Swiftcast'\nimport React from 'react'\nimport {DISPLAY_ORDER} from './DISPLAY_ORDER'\n\nexport class Swiftcast extends CoreSwiftcast {\n\tstatic override displayOrder = DISPLAY_ORDER.SWIFTCAST\n\toverride suggestionContent = <Trans id=\"blu.swiftcast.suggestion.content\">Cast a spell with <DataLink action=\"SWIFTCAST\" /> before it expires.</Trans>\n}\n","import {Plural, Trans} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Event} from 'event'\nimport {Analyser} from 'parser/core/Analyser'\nimport {filter} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {Actors} from 'parser/core/modules/Actors'\nimport {Data} from 'parser/core/modules/Data'\nimport Suggestions, {SEVERITY, TieredSuggestion} from 'parser/core/modules/Suggestions'\nimport React from 'react'\n\n// Triple Trident can be loosely considered as the last step in a combo;\n// you always want to pop\n//\n//  Whistle => Tingle => Triple Trident\n//\n// Although in standard BLU fashion, the first two buttons can be\n// in any order, and you can use any amount of non-Physical attacks\n// after the first two and still get the combo.\n\nexport class TripleTrident extends Analyser {\n\tstatic override handle = 'tripletrident'\n\n\t@dependency private actors!: Actors\n\t@dependency private data!: Data\n\t@dependency private suggestions!: Suggestions\n\n\tprivate unbuffedTT = 0\n\toverride initialise() {\n\t\tsuper.initialise()\n\n\t\tconst playerFilter = filter<Event>().source(this.parser.actor.id)\n\t\tthis.addEventHook(playerFilter.type('action').action(this.data.actions.TRIPLE_TRIDENT.id), this.onTripleTrident)\n\t\tthis.addEventHook('complete', this.onComplete)\n\t}\n\n\tprivate onTripleTrident() {\n\t\tconst hasWhistle = this.actors.current.hasStatus(this.data.statuses.WHISTLE.id)\n\t\tconst hasTingle  = this.actors.current.hasStatus(this.data.statuses.TINGLING.id)\n\t\tif (hasWhistle && hasTingle) {\n\t\t\treturn\n\t\t}\n\t\tthis.unbuffedTT++\n\t}\n\n\tprivate onComplete() {\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.TRIPLE_TRIDENT.icon,\n\t\t\tcontent: <Trans id=\"blu.triple_trident.unbuffed.content\">\n\t\t\t\t<DataLink action=\"TRIPLE_TRIDENT\" /> should always be buffed with <DataLink action=\"WHISTLE\" /> and <DataLink action=\"TINGLE\" />.  For <DataLink action=\"MOON_FLUTE\" /> windows, you want to cast <DataLink action=\"WHISTLE\" showIcon={false} /> and <DataLink action=\"TINGLE\" showIcon={false} /> before casting <DataLink action=\"MOON_FLUTE\" showIcon={false} />.\n\t\t\t</Trans>,\n\t\t\ttiers: {1: SEVERITY.MEDIUM},\n\t\t\tvalue: this.unbuffedTT,\n\t\t\twhy: <Trans id=\"blu.triple_trident.unbuffed.why\">\n\t\t\t\t<Plural value={this.unbuffedTT ?? 0} one=\"# Triple Trident use\" other=\"# Triple Trident uses\" /> were not buffed\n\t\t\t</Trans>,\n\t\t}))\n\t}\n}\n\n","import {Trans, Plural} from '@lingui/react'\nimport {DataLink} from 'components/ui/DbLink'\nimport {Event, Events} from 'event'\nimport {filter} from 'parser/core/filter'\nimport {dependency} from 'parser/core/Injectable'\nimport {Actors} from 'parser/core/modules/Actors'\nimport {TieredSuggestion, SEVERITY} from 'parser/core/modules/Suggestions'\nimport {Weaving, Weave} from 'parser/core/modules/Weaving'\nimport React from 'react'\nimport {DISPLAY_ORDER} from './DISPLAY_ORDER'\n\nconst TO_MILLISECONDS = 1000\nconst MAX_SURPANAKHA_CHARGES = 4\n\nconst MAX_ALLOWED_MULTIWEAVE_DURING_MOON_FLUTE = 6\n\n// Surpanakha has four charges, and each it is pressed, it gives\n// a buff that increases the damage of the next Surpanakha, but\n// ONLY if no other action is used.\n// That \"no other action\" is EXTREMELY strict.  No GCD, no oGCDs,\n// no items, no sprint.\n//\n// Each Surpanakha cast is *roughly* ~850ms, assuming little latency;\n// this module uses a flat 1000ms to accommodate for typical latency.\n//\n// Additionally, the standard opener has us doing a very\n// funny HEXAWEAVE (Swift, Glass Dance, Surpanakha x4) so\n// we need to except that specific situation too.\n//\n\nexport class BLUWeaving extends Weaving {\n\tstatic override displayOrder = DISPLAY_ORDER.WEAVING\n\tprivate badSurpanakhaSequence = 0\n\n\t@dependency private actors!: Actors\n\n\toverride initialise() {\n\t\tsuper.initialise()\n\t\tthis.addEventHook(filter<Event>().type('complete'), this.onCompleteExtra)\n\t}\n\n\toverride getMaxWeaves(weave: Weave) {\n\t\tlet surpanakhas = 0\n\t\tlet foundBadSurpanakhaSequence = false\n\t\tconst weaves: Array<Events['action']> = weave.weaves\n\t\tweaves.forEach(weave => {\n\t\t\tif (weave.action === this.data.actions.SURPANAKHA.id) {\n\t\t\t\tsurpanakhas++\n\t\t\t} else if (surpanakhas >=1 && surpanakhas < MAX_SURPANAKHA_CHARGES) {\n\t\t\t\tfoundBadSurpanakhaSequence = true\n\t\t\t}\n\t\t})\n\n\t\tif (foundBadSurpanakhaSequence || (surpanakhas && surpanakhas !== MAX_SURPANAKHA_CHARGES)) {\n\t\t\tthis.badSurpanakhaSequence++\n\t\t}\n\n\t\tif (surpanakhas && !foundBadSurpanakhaSequence && weaves.length > surpanakhas && weaves.length <= MAX_ALLOWED_MULTIWEAVE_DURING_MOON_FLUTE) {\n\t\t\t// We got four Surpanakhas, they were correctly used in sequence, but there's\n\t\t\t// more to this weave window.\n\t\t\t// If the weave happened after the final Surpanakha then they're unnecessarily\n\t\t\t// clipping their next GCD, so we'll fall through and give them a suggestion\n\t\t\t// based on that\n\t\t\tif (weaves[weaves.length - 1].action === this.data.actions.SURPANAKHA.id) {\n\t\t\t\t// ...but here's the other alternative.  They did the four Surpanakhas at\n\t\t\t\t// the end of the weave slot.  IF they are following the standard opener,\n\t\t\t\t// then they did something like this:\n\t\t\t\t//      Bristle (Swiftcast, Glass Dance, Surpanakha x4)\n\t\t\t\t// So let's be understanding.  During a Moon Flute window, single or\n\t\t\t\t// double weaving *before* the Surpanakhas is potentially fine.\n\t\t\t\tif (this.actors.current.hasStatus(this.data.statuses.WAXING_NOCTURNE.id)) {\n\t\t\t\t\t// Continue the handwavey assumption that any weave takes 1000ms\n\t\t\t\t\tconst extraWeaveTimeMs = TO_MILLISECONDS * (weaves.length + 1)\n\t\t\t\t\tif (weave.gcdTimeDiff < extraWeaveTimeMs) {\n\t\t\t\t\t\treturn weaves.length\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Otherwise, we only accept Surpanakha when it is not weaved with anything else.\n\t\tif (surpanakhas &&\n\t\t\tweaves.length === surpanakhas &&\n\t\t\tweave.gcdTimeDiff < (surpanakhas + 1) * TO_MILLISECONDS) {\n\t\t\treturn surpanakhas\n\t\t}\n\n\t\treturn super.getMaxWeaves(weave)\n\t}\n\n\tprivate onCompleteExtra() {\n\t\t// Give a suggestion for people who didn't use Surpanakha x4, losing the buff and\n\t\t// a bunch of damage.\n\t\t//\n\t\t// There's an edge case here -- Some fights you may want to delay your Moon Flute window by\n\t\t// 30 seconds, at which point you might as well use a single charge of Surpanakha rather than\n\t\t// having it go to waste.\n\t\t//\n\t\t// But if people are clever & skilled enough to do that kind of optimization, then they're\n\t\t// clever enough to understand that they can disregarding the misfiring message.\n\t\tthis.suggestions.add(new TieredSuggestion({\n\t\t\ticon: this.data.actions.SURPANAKHA.icon,\n\t\t\tcontent: <Trans id=\"blu.weaving.bad_surpanakha.content\">\n\t\t\t\tUse all four <DataLink action=\"SURPANAKHA\" /> charges at the same time, with no other actions in-between.  Even <DataLink action=\"SPRINT\" showIcon={false} /> or using an item will cancel the buff.\n\t\t\t</Trans>,\n\t\t\twhy: <Trans id=\"blu.weaving.bad_surpanakha.why\">\n\t\t\t\t<Plural value={this.badSurpanakhaSequence ?? 0} one=\"# Surpanakha chain\" other=\"# Surpanakha chains\" /> dropped the buff early.\n\t\t\t</Trans>,\n\t\t\ttiers: {1: SEVERITY.MAJOR},\n\t\t\tvalue: this.badSurpanakhaSequence,\n\t\t}))\n\t}\n}\n\n","import {LucidDreaming} from 'parser/core/modules/LucidDreaming'\nimport {Tincture} from 'parser/core/modules/Tincture'\nimport {ActionTimeline} from './ActionTimeline'\nimport {AlwaysBeCasting} from './AlwaysBeCasting'\nimport {BLURaidBuffs} from './BLURaidBuffs'\nimport {ColdFog} from './ColdFog'\nimport {BLUDeath} from './Death'\nimport {Defensives} from './Defensives'\nimport {DoTs} from './DoTs'\nimport {DroppedBuffs} from './DroppedBuffs'\nimport {GeneralCDDowntime} from './GeneralCDDowntime'\nimport {Interrupts} from './Interrupts'\nimport {MightyGuardGCDing} from './MightyGuardGCDing'\nimport {MoonFlute} from './MoonFlute'\nimport {BLUOverheal} from './Overheal'\nimport {RevengeBlast} from './RevengeBlast'\nimport {StatusTimeline} from './StatusTimeline'\nimport {Swiftcast} from './Swiftcast'\nimport {TripleTrident} from './TripleTrident'\nimport {BLUWeaving} from './Weaving'\n\nexport default [\n\tMightyGuardGCDing,\n\tDefensives,\n\tActionTimeline,\n\tBLUDeath,\n\tBLUWeaving,\n\tAlwaysBeCasting,\n\tDoTs,\n\tTincture,\n\tInterrupts,\n\tLucidDreaming,\n\tSwiftcast,\n\tGeneralCDDowntime,\n\tMoonFlute,\n\tColdFog,\n\tRevengeBlast,\n\tBLURaidBuffs,\n\tBLUOverheal,\n\tStatusTimeline,\n\tTripleTrident,\n\tDroppedBuffs,\n]\n","require('../../../modules/es.array.flat');\nrequire('../../../modules/es.array.unscopables.flat');\nvar entryVirtual = require('../../../internals/entry-virtual');\n\nmodule.exports = entryVirtual('Array').flat;\n","var flat = require('../array/virtual/flat');\n\nvar ArrayPrototype = Array.prototype;\n\nmodule.exports = function (it) {\n  var own = it.flat;\n  return it === ArrayPrototype || (it instanceof Array && own === ArrayPrototype.flat) ? flat : own;\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar toObject = require('../internals/to-object');\nvar toLength = require('../internals/to-length');\nvar toInteger = require('../internals/to-integer');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flat` method\n// https://tc39.es/ecma262/#sec-array.prototype.flat\n$({ target: 'Array', proto: true }, {\n  flat: function flat(/* depthArg = 1 */) {\n    var depthArg = arguments.length ? arguments[0] : undefined;\n    var O = toObject(this);\n    var sourceLen = toLength(O.length);\n    var A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, depthArg === undefined ? 1 : toInteger(depthArg));\n    return A;\n  }\n});\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('flat');\n","var parent = require('../../es/instance/flat');\n\nmodule.exports = parent;\n"],"names":["module","exports","AlwaysBeCasting","CastTime","Checklist","Data","Downtime","GlobalCooldown","SpeedAdjustments","gcdUptimeSuggestionContent","Trans","id","gcdUptime","gcdsCounted","lastBeginCast","this","addEventHook","filter","source","parser","actor","type","onBeginCast","onCast","onComplete","event","action","data","getAction","onGcd","castTime","forEvent","globalCooldown","getDuration","ANIMATION_LOCK","recastTime","recastForEvent","castStart","timestamp","considerCast","relativeTimestamp","pull","debug","name","formatEpochTimestamp","Math","max","undefined","_action","downtime","isDowntime","fightDuration","currentDuration","getDowntime","uptime","checklist","add","Rule","description","displayOrder","requirements","Requirement","percent","getUptimePercent","target","Analyser","handle","dependency","speedAdjustments","Death","Suggestions","Timeline","info","actorId","getActorInfo","count","actorInfo","currentEpochTimestamp","currentDeadTime","timestampDeath","duration","hp","current","onDeath","status","statuses","TRANSCENDENT","onTranscendentApply","onTranscendentRemove","get","set","timestampTranscendent","counted","shouldCountDeath","queueEvent","raiseHook","value","onRaise","_event","addDeathToTimeline","removeEventHook","_actorId","playerInfo","progress","suggestions","Suggestion","icon","actions","RAISE","content","severity","SEVERITY","why","deathSuggestionWhy","start","end","timeline","addItem","SimpleItem","style","width","height","backgroundColor","SEVERITIES","USE_PERCENT_THRESHOLD","LucidDreaming","lastUse","uses","totalHeld","suggestionContent","Fragment","LUCID_DREAMING","onCastLucid","_held","cooldown","usesMissed","holdDuration","formatDuration","floor","notUsesPercent","TieredSuggestion","tiers","suggestionWhy","dependencies","StatusTimeline","ActionTimeline","Actors","statusActionMap","usages","rows","getRowKey","statusId","targetId","playerPetIds","actors","owner","pet","allPetIds","playerControlled","actorFilter","oneOf","noneOf","onApply","onRemove","statusesApplied","statusUsages","statusTarget","row","createStatusTargetRow","lastUsage","push","getStatus","usage","StatusItem","remappedStatusId","constructor","statusesStackMapping","rowKey","cachedRow","statusRow","createStatusRow","addRow","SimpleRow","label","actionTimeline","getRow","hideCollapsed","collapse","CAST_TIME_MAX_WEAVES","WEAVING_SEVERITY","Weaving","Invulnerability","suggestionIcon","moduleLink","cursor","onClick","scrollTo","message","title","weaves","ongoingCastEvent","leadingGcdEvent","trailingGcdEvent","badWeaves","playerFilter","clearWeave","autoAttack","isOgcd","saveIfBad","length","leadingTimestamp","gcdTimeDiff","invulnerability","weave","isBadWeave","weaveCount","isActive","types","recast","BASE_GCD","getMaxWeaves","matchClosestLower","panels","item","key","events","exclusive","styled","fluid","CoreActionTimeline","lateResolveLabel","diamondBackHistory","History","phantomFlurryHistory","currentPhantomFlurry","phantomFlurryInterruptingActionHook","surpanakhas","phantomFlurryCastFilter","PHANTOM_FLURRY","phantomFlurryStatusFilter","phantomFlurryKick","PHANTOM_FLURRY_KICK","diamondBackFilter","DIAMONDBACK","surpanakhaCastFilter","SURPANAKHA","onApplyPhantomFlurry","onRemovePhantomFlurry","onPhantomFlurryFinalKick","onCastSurpanakha","onDiamondBackApply","onDiamondBackRemove","openNew","closeCurrent","currentFlurry","manualKick","inMoonFlute","hasStatus","WAXING_NOCTURNE","anyActionFilter","flurryDuration","acc","flurry","surpanakhaDuration","diamondBackTimeMs","e","diamondBackSeconds","ceil","missingFlurryTicks","flurryChannelMs","missingFlurryChannelMs","missingFlurryKicks","showIcon","CoreAlwaysBeCasting","BLURaidBuffs","inOffGuard","inPeculiarLight","inLibra","buffHistory","buffActionHook","PECULIAR_LIGHT_ID","PECULIAR_LIGHT","OFF_GUARD_ID","OFF_GUARD","CONDENSED_LIBRA_ASTRAL_ID","CONDENSED_LIBRA_ASTRAL","CONDENSED_LIBRA_UMBRAL_ID","CONDENSED_LIBRA_UMBRAL","CONDENSED_LIBRA_PHYSICAL_ID","CONDENSED_LIBRA_PHYSICAL","previousApply","previousRemove","st","fn","buffAction","isBuffedAction","buffId","overwritten","ours","newBuffHistory","damageType","DamageType","libraIsBuffed","attackElement","elementType","libraAction","CONDENSED_LIBRA","statusFilter","Number","team","Team","onApplyRaidBuff","onRemoveRaidBuff","cur","prev","timestampDelta","isDupedEvent","appliedBuffHistory","currentBuff","getCurrent","newBuff","playerTargets","playerActionFilter","onActionDuringBuff","removedBuff","removedBuffHistory","canRemoveHook","forEach","history","buffCurrent","underPL","underOG","underLibra","buff","ourOverwritten","b","allBuffs","a","ourBuffs","pl","rotationData","buffWindow","buffStart","buffEnd","relevantActionsBuffed","ogBuffed","plBuffed","libraBuffed","buffStatus","Message","Table","compact","unstackable","celled","collapsing","textAlign","marginRight","Button","circular","size","show","COLD_SEVERITY","DROPPED_COLD_FOG","DROPPED_WHITE_DEATH_CASTS","INEFFECTIVE_COLD_FOG","ColdFog","touchOfFrostProcs","coldFogCasts","touchOfFrostHistory","whiteDeathCasts","TOUCH_OF_FROST","onApplyTouchOfFrost","onRemoveTouchOfFrost","COLD_FOG","onApplyColdFog","WHITE_DEATH","onWhiteDeath","droppedColdFogs","showTooltip","ineffectiveColdFog","entry","droppedWhiteDeathCasts","BLUDeath","isFinalSting","actorStings","mydata","FINAL_STING","SELF_DESTRUCT","onFinalSting","stingerId","Defensives","trackedDefensives","ADDLE","MAGIC_HAMMER","currentMimicry","MIMICRY_TANK","MIMICRY_HEALER","MIMICRY_DPS","onApplyMimicry","onCompleteDefensives","DRAGON_FORCE","CHELONIAN_GATE","DEVOUR","ANGELS_SNACK","AETHERIAL_MIMICRY","CoreDefensives","UNBUFFED_SOT","CLIPPING","UPTIME","TARGET","DoTs","bristleId","unbuffedSongsOfTorment","trackedStatuses","BLEEDING","BRISTLE","SONG_OF_TORMENT","onApplyingSoT","onCompleteExtra","myactors","uptimePercent","TieredRule","clippingPerMinute","getClippingAmount","CoreDoTs","DroppedBuffs","currentBuffs","misusedBuffs","STATUSES","dropped","overwrote","buffFilter","onGainBuff","onRemoveBuff","has","delete","clear","statusID","droppedStatusCount","droppedStatus","overwrittenStatusCount","overwrittenStatus","suggestOnDroppedStatus","suggestOnOverwrittenStatus","GeneralCDDowntime","defaultAllowedAverageDowntime","trackedCds","cooldowns","NIGHTBLOOM","firstUseOffset","FEATHER_RAIN","ERUPTION","SHOCK_STRIKE","GLASS_DANCE","allowedAverageDowntime","J_KICK","QUASAR","TRIPLE_TRIDENT","THE_ROSE_OF_DESTRUCTION","suggestionOnlyCooldowns","MATRA_MAGIC","CooldownDowntime","Interrupts","CoreInterrupts","MightyGuardGCDing","hasTankMimickry","damagingActionsUnderMG","currentHook","tankMimickryFilter","onApplyTankMimickry","onRemoveTankMimickry","mightyGuardFilter","MIGHTY_GUARD","onApplyMightyGuard","onRemoveMightyGuard","onActionWithStance","gcds","MISSING_EXPECTED_USES","TOO_FEW_GCDS","neutralOrPositiveOutcome","actual","expected","RotationTargetOutcome","MoonFlute","Cooldowns","windowMissedTT","extraFilter","WANING_NOCTURNE","onWaningNocturneApply","MOON_FLUTE","suggestionWindowName","addEvaluator","ExpectedGcdCountEvaluator","expectedGcds","severityTiers","hasStacks","adjustCount","adjustExpectedGcdCount","bind","mfActionEvaluator","MoonFluteExpectedActionsEvaluator","expectedActions","expectedPerWindow","adjustOutcome","adjustExpectedActionOutcome","setAltAction","BLU_MOUNTAIN_BUSTER","remaining","window","trackedAction","BuffWindow","altActions","foundAltActions","altAction","altActionID","foundAlt","cast","showName","ExpectedActionsEvaluator","BLUOverheal","checklistRuleBreakout","displayPieChart","displaySuggestion","ACTIONS","trackedHealCategories","color","SuggestedColors","trackedHealIds","STOTRAM","EXUVIATION","WHITE_WIND","cause","direct","heal","trackedOverheals","idIsTracked","displayChecklist","Overheal","REVENGE_BLAST_MINIMUM_WINDOW_MS","REVENGE_SEVERITY","WINDOW_MISSED","CAST_OUT_OF_WINDOW","UNWHISTLED_OPENING_REVENGE_BLAST","RevengeBlast","badRevengeBlasts","inRevengeBlastWindow","revengeBlastWindows","hadWhistle","hadRevengeBlast","actionHook","REVENGE_BLAST","onRevengeBlast","onActorUpdate","revengeBlastThreshold","maximum","onRevengeBlastWindow","doIfOpen","WHISTLE","unwhistledWindows","revengeWindow","gcdHeader","header","accessor","gcd","revengeBlastID","dat","revengeStart","revengeEnd","forcedDowntime","deltaMs","expectedGCDs","tableEntry","targetsData","rotation","RotationTable","targets","onGoto","CoreStatusTimeline","Swiftcast","CoreSwiftcast","TripleTrident","unbuffedTT","onTripleTrident","hasWhistle","hasTingle","TINGLING","BLUWeaving","badSurpanakhaSequence","foundBadSurpanakhaSequence","extraWeaveTimeMs","Tincture","entryVirtual","flat","ArrayPrototype","Array","prototype","it","own","$","flattenIntoArray","toObject","toLength","toInteger","arraySpeciesCreate","proto","depthArg","arguments","O","sourceLen","A","addToUnscopables","parent"],"sourceRoot":""}